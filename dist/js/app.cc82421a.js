(function(t){function e(e){for(var a,o,n=e[0],l=e[1],c=e[2],d=0,m=[];d<n.length;d++)o=n[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&m.push(r[o][0]),r[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);u&&u(e);while(m.length)m.shift()();return i.push.apply(i,c||[]),s()}function s(){for(var t,e=0;e<i.length;e++){for(var s=i[e],a=!0,o=1;o<s.length;o++){var l=s[o];0!==r[l]&&(a=!1)}a&&(i.splice(e--,1),t=n(n.s=s[0]))}return t}var a={},r={1:0},i=[];function o(t){return n.p+"js/"+({}[t]||t)+"."+{2:"617b5b3a"}[t]+".js"}function n(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.e=function(t){var e=[],s=r[t];if(0!==s)if(s)e.push(s[2]);else{var a=new Promise((function(e,a){s=r[t]=[e,a]}));e.push(s[2]=a);var i,l=document.createElement("script");l.charset="utf-8",l.timeout=120,n.nc&&l.setAttribute("nonce",n.nc),l.src=o(t);var c=new Error;i=function(e){l.onerror=l.onload=null,clearTimeout(d);var s=r[t];if(0!==s){if(s){var a=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;c.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",c.name="ChunkLoadError",c.type=a,c.request=i,s[1](c)}r[t]=void 0}};var d=setTimeout((function(){i({type:"timeout",target:l})}),12e4);l.onerror=l.onload=i,document.head.appendChild(l)}return Promise.all(e)},n.m=t,n.c=a,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(s,a,function(e){return t[e]}.bind(null,a));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n.oe=function(t){throw console.error(t),t};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],c=l.push.bind(l);l.push=e,l=l.slice();for(var d=0;d<l.length;d++)e(l[d]);var u=c;i.push([0,0]),s()})({0:function(t,e,s){t.exports=s("2f39")},"104d":function(t,e){},"1f5a":function(t,e,s){"use strict";var a=s("8e3b"),r=s.n(a);r.a},"2f39":function(t,e,s){"use strict";s.r(e);s("7d6e"),s("e54f"),s("985d"),s("31cd");var a=s("2b0e"),r=s("1f91"),i=s("42d2"),o=s("b05d"),n=s("18d6"),l=s("a639"),c=s("2a19");a["default"].use(o["a"],{config:{},lang:r["a"],iconSet:i["a"],plugins:{LocalStorage:n["a"],SessionStorage:l["a"],Notify:c["a"]}});var d=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"q-app"}},[s("router-view")],1)},u=[],m={name:"App"},p=m,h=s("2877"),g=Object(h["a"])(p,d,u,!1,null,null,null),v=g.exports,f=s("2f62"),w=function(){return{hide:!1,playing:!1,currentTime:0,duration:0,source:"",queue:[],queueIndex:0,playMode:{id:0,name:"order"},muted:!1,volume:.5,volumeAll:50,volumeWork:0,currentLyric:"",sleepTime:null,sleepMode:!1,rewindSeekTime:5,forwardSeekTime:30,rewindSeekMode:!1,forwardSeekMode:!1}};const q={currentPlayingFile:t=>t.queue[t.queueIndex]||{hash:"",title:"",workTitle:""}};var b=q;const k={TOGGLE_HIDE(t){t.hide=!t.hide},PLAY(t){t.playing=!0},PAUSE(t){t.playing=!1},TOGGLE_PLAYING(t){t.playing=!t.playing},SET_TRACK:(t,e)=>{e>=t.queue.length||e<0||(t.playing=!0,t.queueIndex=e)},NEXT_TRACK:t=>{t.queueIndex<t.queue.length-1&&(t.playing=!0,t.queueIndex+=1)},PREVIOUS_TRACK:t=>{t.queueIndex>0&&(t.playing=!0,t.queueIndex-=1)},SET_QUEUE(t,e){t.queue=e.queue,t.queueIndex=e.index,e.resetPlaying&&(t.playing=!0)},EMPTY_QUEUE:t=>{t.playing=!1,t.queue=[],t.queueIndex=0},ADD_TO_QUEUE:(t,e)=>{t.queue.push(e)},REMOVE_FROM_QUEUE:(t,e)=>{t.queue.splice(e,1),e===t.queueIndex?(t.playing=!1,t.queueIndex=0):e<t.queueIndex&&(t.queueIndex-=1)},SET_DURATION(t,e){t.duration=e},SET_CURRENT_TIME(t,e){t.currentTime=e},PLAY_NEXT:(t,e)=>{t.queue.splice(t.queueIndex+1,0,e)},CHANGE_PLAY_MODE:t=>{const e=[{id:0,name:"order"},{id:1,name:"all repeat"},{id:2,name:"repeat once"},{id:3,name:"shuffle"}],s=t.playMode.id>=e.length-1?0:t.playMode.id+1;t.playMode=e[s]},TOGGLE_MUTED:t=>{t.muted=!t.muted},SET_VOLUME_ALL:(t,e)=>{e<0||e>100||(t.volumeAll=e,t.volumeWork>=-9&&t.volumeWork<=9&&t.volumeAll>=0&&t.volumeAll<=100&&(t.volumeWork>=0?t.volume=t.volumeAll*(1+t.volumeWork)/100:t.volume=t.volumeAll/(1-t.volumeWork)/100,console.log("volumeWork ",t.volumeWork),console.log("volumeAll ",t.volumeAll),console.log("volume ",t.volume)))},SET_VOLUME_WORK:(t,e)=>{e<-9||e>9||(t.volumeWork=e,t.volumeWork>=-9&&t.volumeWork<=9&&t.volumeAll>=0&&t.volumeAll<=100&&(t.volumeWork>=0?t.volume=t.volumeAll*(1+t.volumeWork)/100:t.volume=t.volumeAll/(1-t.volumeWork)/100,console.log("volumeWork ",t.volumeWork),console.log("volumeAll ",t.volumeAll),console.log("volume ",t.volume)))},SET_REWIND_SEEK_TIME:(t,e)=>{t.rewindSeekTime=e},SET_FORWARD_SEEK_TIME:(t,e)=>{t.forwardSeekTime=e},SET_REWIND_SEEK_MODE:(t,e)=>{t.rewindSeekMode=e},SET_FORWARD_SEEK_MODE:(t,e)=>{t.forwardSeekMode=e},SET_CURRENT_LYRIC:(t,e)=>{t.currentLyric=e},SET_SLEEP_TIMER:(t,e)=>{t.sleepTime=e,t.sleepMode=!0},CLEAR_SLEEP_MODE:t=>{t.sleepTime=null,t.sleepMode=!1}};var _=k,y=s("6a18"),x={namespaced:!0,getters:b,mutations:_,actions:y,state:w},S=function(){return{auth:!1,name:"",group:""}},C=s("b5fb");const T={INIT(t,e){t.name=e.name,t.group=e.group},SET_AUTH(t,e){t.auth=e}};var E=T,$=s("104d"),I={namespaced:!0,state:S,getters:C,mutations:E,actions:$};a["default"].use(f["a"]);var P=function(){const t=new f["a"].Store({modules:{AudioPlayer:x,User:I},strict:!1});return t},N=s("8c4f"),L=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-layout",{staticClass:"bg-grey-3",attrs:{view:"hHh Lpr lFf"}},[s("q-header",{staticClass:"shadow-4"},[s("q-toolbar",{staticClass:"row justify-between"},[s("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu"},on:{click:function(e){t.drawerOpen=!t.drawerOpen}}}),t.isNotAtHomePage?s("q-btn",{attrs:{flat:"",size:"md",icon:"arrow_back_ios"},on:{click:function(e){return t.back()}}}):t._e(),s("q-toolbar-title",{staticClass:"gt-xs"},[s("router-link",{staticClass:"text-white",attrs:{to:"/"}},[t._v("\n          Kikoeru\n        ")])],1),s("q-input",{staticClass:"q-mr-sm",attrs:{dark:"",dense:"",rounded:"",standout:"",debounce:"500","input-class":"text-right"},scopedSlots:t._u([{key:"append",fn:function(){return[""===t.keyword?s("q-icon",{attrs:{name:"search"}}):s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"clear"},on:{click:function(e){t.keyword=""}}})]},proxy:!0}]),model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),s("AudioPlayer")],1),s("q-drawer",{attrs:{"show-if-above":"",mini:t.miniState,"mini-to-overlay":"",width:230,breakpoint:500,bordered:"","content-class":"bg-grey-1"},on:{mouseover:function(e){t.miniState=!1},mouseout:function(e){t.miniState=!0}},model:{value:t.drawerOpen,callback:function(e){t.drawerOpen=e},expression:"drawerOpen"}},[s("q-scroll-area",{staticClass:"fit"},[s("q-list",[t._l(t.links,(function(e,a){return s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a,attrs:{clickable:"",exact:"",to:e.path,"active-class":"text-deep-purple text-weight-medium"},on:{click:function(e){t.miniState=!0}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:e.icon}})],1),s("q-item-section",[s("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n              "+t._s(e.title)+"\n            ")])],1)],1)})),s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:t.randomPlay}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:"shuffle"}})],1),s("q-item-section",[s("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n              随心听\n            ")])],1)],1),s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:function(e){t.showTimer=!0}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:"bedtime"}})],1),s("q-item-section",[s("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n              睡眠模式\n            ")])],1)],1)],2),s("q-list",[t.authEnabled?s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:function(e){t.confirm=!0}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:"exit_to_app"}})],1),s("q-item-section",[s("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n              登出\n            ")]),s("q-item-label",{attrs:{caption:"",lines:"2"}},[t._v(t._s(t.userName))])],1)],1):t._e()],1)],1)],1),s("q-dialog",{attrs:{persistent:""},model:{value:t.confirm,callback:function(e){t.confirm=e},expression:"confirm"}},[s("q-card",[s("q-card-section",{staticClass:"row items-center"},[s("q-avatar",{attrs:{icon:"power_settings_new",color:"primary","text-color":"white"}}),s("span",{staticClass:"q-ml-sm"},[t._v("是否退出登录？（若未开启用户验证，则操作无效）")])],1),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消",color:"primary"}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"退出",color:"primary"},on:{click:function(e){return t.logout()}}})],1)],1)],1),s("SleepMode",{model:{value:t.showTimer,callback:function(e){t.showTimer=e},expression:"showTimer"}}),s("q-page-container",[s("keep-alive",{attrs:{include:"Works"}},[s("router-view")],1),s("q-page-scroller",{attrs:{position:"bottom-right","scroll-offset":150,offset:[18,18]}},[s("q-btn",{attrs:{fab:"",icon:"keyboard_arrow_up",color:"accent"}})],1)],1),s("q-footer",{staticClass:"q-pa-none"},[s("LyricsBar"),s("PlayerBar")],1)],1)},Q=[],R=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-slide-transition",{staticClass:"bordered elevated"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.currentPlayingFile.hash&&t.hide,expression:"currentPlayingFile.hash && hide"}],staticClass:"row bg-white text-black"},[s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"col non-selectable",staticStyle:{padding:"0px 5px"},attrs:{clickable:""},on:{click:function(e){return t.toggleHide()}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-img",{staticClass:"rounded-borders",staticStyle:{height:"50px",width:"50px"},attrs:{transition:"fade",src:t.samCoverUrl}})],1),s("q-item-section",[s("q-item-label",{attrs:{lines:"2"}},[t._v(t._s(t.currentPlayingFile.title))]),s("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(t.currentPlayingFile.workTitle))])],1)],1),s("q-btn",{staticClass:"col-auto gt-sm",staticStyle:{height:"60px",width:"60px"},attrs:{flat:"",size:"lg",icon:"skip_previous"},on:{click:function(e){return t.previousTrack()}}}),s("q-btn",{staticClass:"col-auto",staticStyle:{height:"60px",width:"60px"},attrs:{flat:"",size:"lg",icon:t.playingIcon},on:{click:function(e){return t.togglePlaying()}}}),s("q-btn",{staticClass:"col-auto gt-sm",staticStyle:{height:"60px",width:"60px"},attrs:{flat:"",size:"lg",icon:"skip_next"},on:{click:function(e){return t.nextTrack()}}})],1)])},A=[],M={name:"PlayerBar",computed:{samCoverUrl(){const t=this.$q.localStorage.getItem("jwt-token")||"",e=this.currentPlayingFile.hash;return e?`/api/cover/${e.split("/")[0]}?type=sam&token=${t}`:""},playingIcon(){return this.playing?"pause":"play_arrow"},...Object(f["d"])("AudioPlayer",["hide","playing"]),...Object(f["b"])("AudioPlayer",["currentPlayingFile"])},methods:{toggleHide(){this.$store.commit("AudioPlayer/TOGGLE_HIDE")},togglePlaying(){this.$store.commit("AudioPlayer/TOGGLE_PLAYING")},nextTrack(){this.$store.commit("AudioPlayer/NEXT_TRACK")},previousTrack(){this.$store.commit("AudioPlayer/PREVIOUS_TRACK")}}},O=M,U=s("e9c1"),D=s("66e5"),F=s("4074"),j=s("068f"),B=s("0170"),W=s("9c40"),z=s("714f"),K=s("eebe"),G=s.n(K),H=Object(h["a"])(O,R,A,!1,null,null,null),Y=H.exports;G()(H,"components",{QSlideTransition:U["a"],QItem:D["a"],QItemSection:F["a"],QImg:j["a"],QItemLabel:B["a"],QBtn:W["a"]}),G()(H,"directives",{Ripple:z["a"]});var V=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("q-slide-transition",[s("q-card",{directives:[{name:"show",rawName:"v-show",value:t.currentPlayingFile.hash&&!t.hide,expression:"currentPlayingFile.hash && !hide"}],staticClass:"fixed-bottom-right bg-white text-black audio-player",attrs:{square:""},on:{mousewheel:function(t){t.preventDefault()},touchmove:function(t){t.preventDefault()}}},[s("div",{staticClass:"bg-dark row items-center albumart"},[s("q-img",{attrs:{contain:"",transition:"fade",src:t.coverUrl,ratio:4/3}}),s("q-btn",{staticClass:"absolute-top-left q-ma-sm",attrs:{dense:"",round:"",size:"md",color:"white","text-color":"dark",icon:"keyboard_arrow_down"},on:{click:function(e){return t.toggleHide()}}}),s("q-btn",{staticClass:"absolute-top-right q-ma-sm",attrs:{dense:"",round:"",size:"md",color:"white","text-color":"dark",icon:"more_vert"}},[s("q-menu",{attrs:{anchor:"bottom right",self:"top right"}},[s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(e){t.hideSeekButton=!t.hideSeekButton}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:t.hideSeekButton?"done":""}})],1),s("q-item-section",[t._v("\n                隐藏封面按钮\n              ")])],1),s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(e){t.swapSeekButton=!t.swapSeekButton}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:t.swapSeekButton?"done":""}})],1),s("q-item-section",[t._v("\n                交换进度按钮与切换按钮\n              ")])],1),s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"},{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return t.openWorkDetail()}}},[s("q-item-section",{attrs:{avatar:""}}),s("q-item-section",[t._v("\n                打开作品详情\n              ")])],1)],1)],1),s("div",{staticClass:"row absolute q-pl-md q-pr-md col-12 justify-between"},[t.hideSeekButton?t._e():s("q-btn",{staticStyle:{opacity:"0.8"},attrs:{round:"",size:"lg",color:"white","text-color":"dark",icon:t.swapSeekButton?"skip_previous":t.rewindIcon},on:{click:function(e){t.swapSeekButton?t.previousTrack():t.rewind(!0)}}}),t.hideSeekButton?t._e():s("q-btn",{staticStyle:{opacity:"0.8"},attrs:{round:"",size:"lg",color:"white","text-color":"dark",icon:t.swapSeekButton?"skip_next":t.forwardIcon},on:{click:function(e){t.swapSeekButton?t.nextTrack():t.forward(!0)}}})],1)],1),s("div",{staticClass:"row items-center q-mx-sm q-my-sm",staticStyle:{height:"40px"}},[s("div",{staticClass:"col-auto"},[t._v(t._s(t.formatSeconds(t.currentTime)))]),s("AudioElement",{staticClass:"col"}),s("div",{staticClass:"col-auto"},[t._v(t._s(t.formatSeconds(t.duration)))])],1),t.$q.platform.is.ios?s("div",{staticStyle:{height:"5px"}}):t._e(),s("q-item",{staticClass:"text-center non-selectable",staticStyle:{height:"55px",padding:"0px 15px"}},[s("q-item-section",[s("q-item-label",{staticClass:"text-bold",attrs:{lines:"2"}},[t._v(t._s(t.currentPlayingFile.title))]),s("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(t.currentPlayingFile.workTitle))])],1)],1),t.$q.platform.is.ios?s("div",{staticStyle:{height:"10px"}}):t._e(),s("div",{staticClass:"row justify-around",staticStyle:{height:"65px"}},[s("q-btn",{staticClass:"col-auto",staticStyle:{width:"55px"},attrs:{flat:"",dense:"",size:"md",icon:"queue_music"},on:{click:function(e){t.showCurrentPlayList=!t.showCurrentPlayList}}}),s("q-btn",{staticClass:"col-auto",staticStyle:{width:"55px"},attrs:{flat:"",dense:"",size:"lg",icon:t.swapSeekButton?t.rewindIcon:"skip_previous"},on:{click:function(e){t.swapSeekButton?t.rewind(!0):t.previousTrack()}}}),s("q-btn",{staticClass:"col-auto",staticStyle:{width:"65px"},attrs:{flat:"",dense:"",size:"28px",icon:t.playingIcon},on:{click:function(e){return t.togglePlaying()}}}),s("q-btn",{staticClass:"col-auto",staticStyle:{width:"55px"},attrs:{flat:"",dense:"",size:"lg",icon:t.swapSeekButton?t.forwardIcon:"skip_next"},on:{click:function(e){t.swapSeekButton?t.forward(!0):t.nextTrack()}}}),s("q-btn",{staticClass:"col-auto",staticStyle:{width:"55px"},attrs:{flat:"",dense:"",size:"md",icon:t.playModeIcon},on:{click:function(e){return t.changePlayMode()}}})],1),t.$q.platform.is.ios?t._e():s("div",{staticClass:"row items-center q-mx-lg",staticStyle:{height:"30px"}},[s("q-icon",{staticClass:"col-auto",attrs:{name:"volume_down",size:"sm"}}),s("vue-slider",{staticClass:"col",attrs:{min:0,max:100,interval:1,dragOnClick:!0,contained:!0,tooltip:"none"},model:{value:t.volumeAll,callback:function(e){t.volumeAll=e},expression:"volumeAll"}}),s("q-icon",{staticClass:"col-auto",attrs:{name:"volume_up",size:"sm"}})],1),t.$q.platform.is.ios?t._e():s("div",{staticClass:"row items-center q-mx-lg",staticStyle:{height:"30px"}},[s("vue-slider",{staticClass:"col",attrs:{min:-9,max:9,interval:1,dragOnClick:!0,contained:!0,tooltip:"none"},model:{value:t.volumeWork,callback:function(e){t.volumeWork=e},expression:"volumeWork"}})],1)],1)],1),s("q-dialog",{model:{value:t.showCurrentPlayList,callback:function(e){t.showCurrentPlayList=e},expression:"showCurrentPlayList"}},[s("q-card",{staticClass:"current-play-list"},[s("div",{staticClass:"row",staticStyle:{padding:"5px",height:"45px"}},[s("q-btn",{staticClass:"col-auto",staticStyle:{height:"35px",width:"35px"},attrs:{dense:"",round:"",size:"md",icon:"edit",color:"primary"},on:{click:function(e){t.editCurrentPlayList=!t.editCurrentPlayList}}}),s("q-btn",{staticClass:"col-auto q-mx-sm",staticStyle:{height:"35px",width:"35px"},attrs:{dense:"",round:"",size:"md",icon:"save",color:"teal"}}),s("q-space"),s("q-btn",{staticClass:"col-auto",staticStyle:{height:"35px",width:"35px"},attrs:{dense:"",round:"",size:"md",icon:"delete_forever",color:"red"},on:{click:function(e){return t.emptyQueue()}}})],1),s("q-separator"),s("q-list",{staticClass:"scroll",staticStyle:{"max-height":"450px"}},[s("draggable",{attrs:{handle:".handle"},on:{change:function(e){return t.onMoved(e.moved)}},model:{value:t.queueCopy,callback:function(e){t.queueCopy=e},expression:"queueCopy"}},t._l(t.queueCopy,(function(e,a){return s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a,staticClass:"non-selectable",staticStyle:{height:"48px",padding:"0px 10px"},attrs:{clickable:"",active:t.queueIndex===a,"active-class":"text-white bg-teal"},on:{click:function(e){return t.onClickTrack(a)}}},[s("q-item-section",{directives:[{name:"show",rawName:"v-show",value:t.editCurrentPlayList,expression:"editCurrentPlayList"}],attrs:{side:""}},[s("q-icon",{attrs:{name:"clear",color:t.queueIndex===a?"white":"red"},on:{click:function(e){return t.removeFromQueue(a)}}})],1),s("q-item-section",{attrs:{avatar:""}},[s("q-img",{staticClass:"rounded-borders",staticStyle:{height:"38px",width:"38px"},attrs:{transition:"fade",src:t.samCoverUrl(e.hash)}})],1),s("q-item-section",[s("q-item-label",{attrs:{lines:"1"}},[t._v(t._s(e.title))]),s("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(e.workTitle))])],1),s("q-item-section",{directives:[{name:"show",rawName:"v-show",value:t.editCurrentPlayList,expression:"editCurrentPlayList"}],staticClass:"handle",attrs:{side:""}},[s("q-icon",{attrs:{name:"reorder",color:t.queueIndex===a?"white":"dark"}})],1)],1)})),1)],1)],1)],1)],1)},J=[],X=s("b76a"),Z=s.n(X),tt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("vue-plyr",{ref:"plyr",attrs:{emit:["canplay","timeupdate","ended","seeked","playing","waiting","pause"]},on:{canplay:function(e){return t.onCanplay()},timeupdate:function(e){return t.onTimeupdate()},ended:function(e){return t.onEnded()},seeked:function(e){return t.onSeeked()},playing:function(e){return t.onPlaying()},waiting:function(e){return t.onWaiting()},pause:function(e){return t.onPause()}}},[s("audio",{attrs:{crossorigin:"anonymous"}},[t.source?s("source",{attrs:{src:t.source}}):t._e()])])},et=[],st=s("e6bb"),at=s.n(st),rt={methods:{showSuccNotif(t){this.$q.notify({message:t,color:"positive",icon:"done",timeout:500})},showWarnNotif(t){this.$q.notify({message:t,color:"warning",icon:"warning"})},showErrNotif(t){this.$q.notify({message:t,color:"negative",icon:"bug_report"})}}},it={name:"AudioElement",mixins:[rt],data(){return{lrcObj:null,lrcAvailable:!1}},computed:{player(){return this.$refs.plyr.player},source(){const t=this.$q.localStorage.getItem("jwt-token")||"";return this.currentPlayingFile.mediaStreamUrl?`${this.currentPlayingFile.mediaStreamUrl}?token=${t}`:this.currentPlayingFile.hash?`/api/media/stream/${this.currentPlayingFile.hash}?token=${t}`:""},...Object(f["d"])("AudioPlayer",["playing","queue","queueIndex","playMode","muted","volume","sleepTime","sleepMode","rewindSeekTime","forwardSeekTime","rewindSeekMode","forwardSeekMode"]),...Object(f["b"])("AudioPlayer",["currentPlayingFile"])},watch:{playing(t){this.player.duration&&(t?this.player.play():this.player.pause())},source(t){t&&(this.player.media.load(),this.loadLrcFile())},muted(t){this.player.muted=t},volume(t){console.log("element  volume 真实设定  旧值 "+this.player.volume+"   新值："+t),t<0||t>10||(this.player.volume=t,console.log("音量最终值："+this.player.volume))},rewindSeekMode(t){t&&(this.player.rewind(this.rewindSeekTime),this.SET_REWIND_SEEK_MODE(!1))},forwardSeekMode(t){t&&(this.player.forward(this.forwardSeekTime),this.SET_FORWARD_SEEK_MODE(!1))}},methods:{onPause(){this.playLrc(!1),this.PAUSE()},onPlaying(){this.playLrc(!0),this.PLAY()},onWaiting(){this.playLrc(!1),this.PLAY()},...Object(f["c"])("AudioPlayer",["SET_DURATION","SET_CURRENT_TIME","PAUSE","PLAY","SET_TRACK","NEXT_TRACK","SET_CURRENT_LYRIC","CLEAR_SLEEP_MODE","SET_REWIND_SEEK_MODE","SET_FORWARD_SEEK_MODE"]),onCanplay(){this.SET_DURATION(this.player.duration),this.playing&&this.player.currentTime!==this.player.duration&&this.player.play()},onTimeupdate(){if(this.SET_CURRENT_TIME(this.player.currentTime),this.sleepMode&&this.sleepTime){const t=new Date,e=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0"),a=this.sleepTime.match(/\d+/g)[0],r=this.sleepTime.match(/\d+/g)[1];e===a&&s===r&&(this.PAUSE(),this.CLEAR_SLEEP_MODE(),this.$q.sessionStorage.set("sleepTime",null),this.$q.sessionStorage.set("sleepMode",!1))}},onEnded(){switch(this.playMode.name){case"all repeat":this.queueIndex===this.queue.length-1?this.SET_TRACK(0):this.NEXT_TRACK();break;case"repeat once":this.player.currentTime=0,this.player.play(),this.PLAY();break;case"shuffle":{const t=Math.floor(Math.random()*this.queue.length);this.SET_TRACK(t),t===this.queueIndex&&(this.player.currentTime=0);break}default:this.queueIndex===this.queue.length-1?this.PAUSE():this.NEXT_TRACK()}},onSeeked(){},playLrc(t){this.lrcAvailable&&(t?this.lrcObj.play(1e3*this.player.currentTime):this.lrcObj.pause())},initLrcObj(){this.lrcObj=new at.a({onPlay:(t,e)=>{this.SET_CURRENT_LYRIC(e)}})},loadLrcFile(){const t=this.$q.localStorage.getItem("jwt-token")||"",e=this.queue[this.queueIndex].hash,s=`/api/media/check-lrc/${e}?token=${t}`;this.$axios.get(s).then(e=>{if(e.data.result){this.lrcAvailable=!0,console.log("读入歌词");const s=`/api/media/stream/${e.data.hash}?token=${t}`;this.$axios.get(s).then(t=>{console.log("歌词读入成功"),this.lrcObj.setLyric(t.data),this.lrcObj.play(1e3*this.player.currentTime)})}else this.lrcAvailable=!1,this.lrcObj.setLyric(""),this.SET_CURRENT_LYRIC("")}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}},mounted(){console.log("element 的 mounted 方法调用"),this.initLrcObj(),this.source&&this.loadLrcFile()}},ot=it,nt=Object(h["a"])(ot,tt,et,!1,null,null,null),lt=nt.exports,ct={name:"AudioPlayer",components:{draggable:Z.a,AudioElement:lt},data(){return{showCurrentPlayList:!1,editCurrentPlayList:!1,queueCopy:[],hideSeekButton:!1,swapSeekButton:!1}},mounted(){this.$q.localStorage.has("hideSeekButton")&&(this.hideSeekButton=this.$q.localStorage.getItem("hideSeekButton")),this.$q.localStorage.has("swapSeekButton")&&(this.swapSeekButton=this.$q.localStorage.getItem("swapSeekButton"))},watch:{queue(t){this.queueCopy=t.concat(),0===this.queueCopy.length&&(this.showCurrentPlayList=!1)},showCurrentPlayList(t){!1===t&&(this.editCurrentPlayList=!1)},hideSeekButton(t){this.$q.localStorage.set("hideSeekButton",t)},swapSeekButton(t){this.$q.localStorage.set("swapSeekButton",t)}},computed:{coverUrl(){const t=this.$q.localStorage.getItem("jwt-token")||"",e=this.currentPlayingFile.hash;return e?`/api/cover/${e.split("/")[0]}?token=${t}`:""},workDetailUrl(){const t=this.currentPlayingFile.hash;return t?"/work/"+t.split("/")[0]:""},volumeAll:{get(){return this.$store.state.AudioPlayer.volumeAll},set(t){this.SET_VOLUME_ALL(t)}},volumeWork:{get(){return this.$store.state.AudioPlayer.volumeWork},set(t){this.SET_VOLUME_WORK(t)}},queue:{get(){return this.$store.state.AudioPlayer.queue},set(){}},playModeIcon(){switch(this.playMode.name){case"all repeat":return"repeat";case"repeat once":return"repeat_one";case"shuffle":return"shuffle";default:return"playlist_play"}},playingIcon(){return this.playing?"pause":"play_arrow"},rewindIcon(){switch(this.rewindSeekTime){case 5:return"replay_5";case 10:return"replay_10";case 30:return"replay_30";default:return"replay_5"}},forwardIcon(){switch(this.forwardSeekTime){case 5:return"forward_5";case 10:return"forward_10";case 30:return"forward_30";default:return"forward_5"}},...Object(f["d"])("AudioPlayer",["playing","hide","currentTime","duration","queueIndex","playMode","rewindSeekTime","forwardSeekTime"]),...Object(f["b"])("AudioPlayer",["currentPlayingFile"])},methods:{...Object(f["c"])("AudioPlayer",{toggleHide:"TOGGLE_HIDE",togglePlaying:"TOGGLE_PLAYING",nextTrack:"NEXT_TRACK",previousTrack:"PREVIOUS_TRACK",changePlayMode:"CHANGE_PLAY_MODE",setVolumeAll:"SET_VOLUME_ALL",setVolumeWork:"SET_VOLUME_WORK",rewind:"SET_REWIND_SEEK_MODE",forward:"SET_FORWARD_SEEK_MODE"}),...Object(f["c"])("AudioPlayer",["SET_TRACK","SET_QUEUE","REMOVE_FROM_QUEUE","EMPTY_QUEUE","SET_VOLUME_ALL","SET_VOLUME_WORK"]),formatSeconds(t){let e=Math.floor(t/3600)<10?"0"+Math.floor(t/3600):Math.floor(t/3600),s=Math.floor(t/60%60)<10?"0"+Math.floor(t/60%60):Math.floor(t/60%60),a=Math.floor(t%60)<10?"0"+Math.floor(t%60):Math.floor(t%60);return"00"===e?s+":"+a:e+":"+s+":"+a},samCoverUrl(t){const e=this.$q.localStorage.getItem("jwt-token")||"";return t?`/api/cover/${t.split("/")[0]}?type=sam&token=${e}`:""},onClickTrack(t){this.editCurrentPlayList||(this.SET_TRACK(t),this.showCurrentPlayList=!1)},onMoved(t){let e=null;e=t.oldIndex===this.queueIndex?t.newIndex:t.oldIndex<this.queueIndex&&t.newIndex>=this.queueIndex?this.queueIndex-1:t.oldIndex>this.queueIndex&&t.newIndex<=this.queueIndex?this.queueIndex+1:this.queueIndex,this.SET_QUEUE({queue:this.queueCopy.concat(),index:e,resetPlaying:!1})},removeFromQueue(t){this.REMOVE_FROM_QUEUE(t)},emptyQueue(){this.EMPTY_QUEUE()},openWorkDetail(){this.workDetailUrl&&this.$route.path!==this.workDetailUrl&&this.$router.push(this.workDetailUrl),this.$q.screen.lt.sm&&this.toggleHide()}}},dt=ct,ut=(s("d2a8"),s("f09f")),mt=s("4e73"),pt=s("0016"),ht=s("24e8"),gt=s("2c91"),vt=s("eb85"),ft=s("1c1c"),wt=s("7f67"),qt=Object(h["a"])(dt,V,J,!1,null,"27d7c1aa",null),bt=qt.exports;G()(qt,"components",{QSlideTransition:U["a"],QCard:ut["a"],QImg:j["a"],QBtn:W["a"],QMenu:mt["a"],QItem:D["a"],QItemSection:F["a"],QIcon:pt["a"],QItemLabel:B["a"],QDialog:ht["a"],QSpace:gt["a"],QSeparator:vt["a"],QList:ft["a"]}),G()(qt,"directives",{Ripple:z["a"],ClosePopup:wt["a"]});var kt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-card",{attrs:{id:"draggable"},on:{mousedown:t.onCursorDown,mouseup:t.onCursorUp,touchstart:t.onCursorDown,touchend:t.onCursorUp}},[s("div",{staticClass:"text-center text-h6 text-bold ellipsis-2-lines text-purple q-mb-md absolute-bottom",attrs:{id:"lyricsBar"}},[s("span",{attrs:{id:"lyric"}},[t._v("\n          "+t._s(t.currentLyric)+"\n        ")])])])},_t=[];const yt=t=>e=>{if(!t.beTouched)return;const s=t.getTouch(e),a=s.clientX-t.startX,r=s.clientY-t.startY;t.draggable.style.left=a+"px",t.draggable.style.top=r+"px"};var xt={name:"LyricsBar",computed:{...Object(f["d"])("AudioPlayer",["currentLyric"]),draggable(){return document.getElementById("draggable")}},data(){return{beTouched:!1,startX:0,startY:0}},methods:{getTouch(t){return t.touches?t.touches[0]:t},onCursorDown(t){t.preventDefault(),this.beTouched=!0;const e=this.getTouch(t);this.startX=e.clientX-this.draggable.offsetLeft,this.startY=e.clientY-this.draggable.offsetTop},onCursorUp(t){t.preventDefault(),this.beTouched=!1}},mounted(){addEventListener("mousemove",yt(this),!1),addEventListener("touchmove",yt(this),!1)}},St=xt,Ct=(s("b3a5"),Object(h["a"])(St,kt,_t,!1,null,null,null)),Tt=Ct.exports;G()(Ct,"components",{QCard:ut["a"]});var Et=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-dialog",{attrs:{value:t.value,persistent:""},on:{input:function(e){return t.$emit("input")}}},[s("q-card",[s("div",{staticClass:"q-pa-sm"},[s("q-time",{attrs:{"now-btn":"",dark:t.sleepMode},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),s("div",{staticClass:"row justify-between"},[s("q-card-actions",[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消定时",color:"primary",disable:!t.sleepMode},on:{click:t.clearSleepTimer}})],1),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消",color:"primary"}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确定",color:"primary"},on:{click:t.setSleepTimer}})],1)],1)])],1)},$t=[],It={name:"SleepMode",props:["value"],data(){return{time:"00:00"}},computed:{...Object(f["d"])("AudioPlayer",["sleepTime","sleepMode"])},mounted(){try{this.$q.sessionStorage.getItem("sleepMode")&&this.SET_SLEEP_TIMER(this.$q.sessionStorage.getItem("sleepTime"))}catch{console.log("Web Storage API error")}},watch:{value(t){if(t)if(this.sleepMode)this.time=this.sleepTime;else{const t=new Date;this.time=t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")}}},methods:{...Object(f["c"])("AudioPlayer",["SET_SLEEP_TIMER","CLEAR_SLEEP_MODE"]),setSleepTimer(){this.SET_SLEEP_TIMER(this.time);try{this.$q.sessionStorage.set("sleepTime",this.time),this.$q.sessionStorage.set("sleepMode",!0)}catch{console.log("Web Storage API error")}this.showSuccNotif(`将于${this.time}停止播放`)},clearSleepTimer(){this.CLEAR_SLEEP_MODE();try{this.$q.sessionStorage.set("sleepTime",null),this.$q.sessionStorage.set("sleepMode",!1)}catch{console.log("Web Storage API error")}this.showSuccNotif("已关闭睡眠模式")},showSuccNotif(t){this.$q.notify({message:t,color:"primary",icon:"bedtime",timeout:5e3})}}},Pt=It,Nt=s("ca78"),Lt=s("4b7e"),Qt=Object(h["a"])(Pt,Et,$t,!1,null,null,null),Rt=Qt.exports;G()(Qt,"components",{QDialog:ht["a"],QCard:ut["a"],QTime:Nt["a"],QCardActions:Lt["a"],QBtn:W["a"]}),G()(Qt,"directives",{ClosePopup:wt["a"]});var At={name:"MainLayout",mixins:[rt],components:{PlayerBar:Y,AudioPlayer:bt,LyricsBar:Tt,SleepMode:Rt},data(){return{keyword:"",drawerOpen:!1,miniState:!0,confirm:!1,randId:null,showTimer:!1,links:[{title:"媒体库",icon:"widgets",path:"/"},{title:"我的收藏",icon:"favorite",path:"/favourites"},{title:"社团",icon:"group",path:"/circles"},{title:"系列",icon:"share",path:"/series"},{title:"标签",icon:"label",path:"/tags"},{title:"声优",icon:"mic",path:"/vas"},{title:"高级设置",icon:"settings",path:"/admin/advanced"},{title:"音声库",icon:"folder",path:"/admin"},{title:"扫描",icon:"youtube_searched_for",path:"/admin/scanner"},{title:"用户管理",icon:"person",path:"/admin/usermanage"}],sharedConfig:{}}},watch:{keyword(){this.$router.push(this.keyword?"/works?keyword="+this.keyword:"/works")},randId(){this.$router.push("/work/"+this.randId)},sharedConfig(t){this.SET_REWIND_SEEK_TIME(t.rewindSeekTime),this.SET_FORWARD_SEEK_TIME(t.forwardSeekTime)}},mounted(){this.initUser(),this.checkUpdate(),this.readSharedConfig()},sockets:{success(t){this.showSuccNotif(t.message),t.auth&&(this.$store.commit("User/INIT",t.user),this.$store.commit("User/SET_AUTH",t.auth))},error(t){this.showWarnNotif(t.message||t),this.$socket.close(),this.$router.push("/login")}},created(){const t=this.$q.localStorage.getItem("jwt-token")||"";this.$socket.io.opts.query.auth_token=t,this.$socket.connected||this.$socket.open()},computed:{isNotAtHomePage(){const t=this.$route.path;return t&&"/"!==t&&"/works"!==t&&"/favourites"!==t},...Object(f["d"])("User",{userName:"name",authEnabled:"auth"})},methods:{...Object(f["c"])("AudioPlayer",["SET_REWIND_SEEK_TIME","SET_FORWARD_SEEK_TIME"]),initUser(){this.$axios.get("/api/auth/me").then(t=>{this.$store.commit("User/INIT",t.data.user),this.$store.commit("User/SET_AUTH",t.data.auth)}).catch(t=>{if(t.response)if(401===t.response.status){const t=this.$router.currentRoute.path;"/login"!==t&&this.$router.push("/login")}else this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`);else this.showErrNotif(t.message||t)})},checkUpdate(){this.$axios.get("/api/version").then(t=>{t.data.update_available&&t.data.notifyUser&&this.$q.notify({message:"GitHub上有新版本",color:"primary",textColor:"white",icon:"cloud_download",timeout:5e3,actions:[{label:"好",color:"white"},{label:"查看",color:"white",handler:()=>{Object.assign(document.createElement("a"),{target:"_blank",href:"https://github.com/umonaca/kikoeru-express/releases"}).click()}}]}),t.data.lockFileExists&&this.$q.notify({message:t.data.lockReason,type:"warning",timeout:6e4,actions:[{label:"以后提醒我",color:"black"},{label:"前往扫描页",color:"black",handler:()=>this.$router.push("/admin/scanner")}]})}).catch(t=>{console.error(t)})},readSharedConfig(){this.$axios.get("/api/config/shared").then(t=>{this.sharedConfig=t.data.sharedConfig}).catch(t=>{if(t.response)if(401===t.response.status){const t=this.$router.currentRoute.path;"/login"!==t&&this.$router.push("/login")}else this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`);else this.showErrNotif(t.message||t)})},randomPlay(){this.requestRandomWork()},requestRandomWork(){const t={order:"betterRandom"};this.$axios.get("/api/works",{params:t}).then(t=>{const e=t.data.works;this.randId=e.length?e[0].id:null}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},logout(){this.$q.localStorage.set("jwt-token",""),this.$router.push("/login")},back(){this.$router.go(-1)}}},Mt=At,Ot=(s("89d3"),s("4d5a")),Ut=s("e359"),Dt=s("65c6"),Ft=s("6ac5"),jt=s("27f9"),Bt=s("9404"),Wt=s("4983"),zt=s("a370"),Kt=s("cb32"),Gt=s("09e3"),Ht=s("9989"),Yt=s("5096"),Vt=s("7ff0"),Jt=Object(h["a"])(Mt,L,Q,!1,null,null,null),Xt=Jt.exports;G()(Jt,"components",{QLayout:Ot["a"],QHeader:Ut["a"],QToolbar:Dt["a"],QBtn:W["a"],QToolbarTitle:Ft["a"],QInput:jt["a"],QIcon:pt["a"],QDrawer:Bt["a"],QScrollArea:Wt["a"],QList:ft["a"],QItem:D["a"],QItemSection:F["a"],QItemLabel:B["a"],QDialog:ht["a"],QCard:ut["a"],QCardSection:zt["a"],QAvatar:Kt["a"],QCardActions:Lt["a"],QPageContainer:Gt["a"],QPage:Ht["a"],QPageScroller:Yt["a"],QFooter:Vt["a"]}),G()(Jt,"directives",{Ripple:z["a"],ClosePopup:wt["a"]});var Zt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"text-h5 text-weight-regular q-ma-md"},[t._v("\n    "+t._s(t.pageTitle)+"\n    "),s("span",{directives:[{name:"show",rawName:"v-show",value:t.pagination.totalCount,expression:"pagination.totalCount"}]},[t._v("\n      ("+t._s(t.pagination.totalCount)+")\n    ")])]),s("div",{class:"row justify-center "+(t.listMode?"list":"q-mx-md")},[s("q-infinite-scroll",{staticClass:"col",staticStyle:{"max-width":"1680px"},attrs:{offset:250,disable:t.stopLoad},on:{load:t.onLoad},scopedSlots:t._u([{key:"loading",fn:function(){return[s("div",{staticClass:"row justify-center q-my-md"},[s("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}])},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.works.length,expression:"works.length"}],staticClass:"row justify-between q-mb-md q-mr-sm"},[s("q-select",{staticClass:"col-auto",attrs:{dense:"",rounded:"",outlined:"","bg-color":"white","transition-show":"scale","transition-hide":"scale",options:t.options,label:"排序"},model:{value:t.sortOption,callback:function(e){t.sortOption=e},expression:"sortOption"}}),s("q-btn-toggle",{staticClass:"col-auto",staticStyle:{width:"85px"},attrs:{dense:"",spread:"",rounded:"","toggle-color":"primary",color:"white","text-color":"primary",options:[{icon:"apps",value:!1},{icon:"list",value:!0}]},model:{value:t.listMode,callback:function(e){t.listMode=e},expression:"listMode"}}),t.$q.screen.width>700&&t.listMode?s("q-btn-toggle",{staticClass:"col-auto",staticStyle:{width:"85px"},attrs:{dense:"",spread:"",rounded:"","toggle-color":"primary",color:"white","text-color":"primary",options:[{icon:"label",value:!0},{icon:"label_off",value:!1}]},model:{value:t.showLabel,callback:function(e){t.showLabel=e},expression:"showLabel"}}):t._e(),t.$q.screen.width>700&&!t.listMode?s("q-btn-toggle",{staticClass:"col-auto",staticStyle:{width:"85px"},attrs:{dense:"",spread:"",rounded:"",disable:t.$q.screen.width<1120,"toggle-color":"primary",color:"white","text-color":"primary",options:[{icon:"zoom_in",value:!0},{icon:"zoom_out",value:!1}]},model:{value:t.detailMode,callback:function(e){t.detailMode=e},expression:"detailMode"}}):t._e()],1),t.listMode?s("q-list",{staticClass:"shadow-2",attrs:{bordered:"",separator:""}},t._l(t.works,(function(e){return s("WorkListItem",{key:e.id,attrs:{metadata:e,showLabel:t.showLabel&&t.$q.screen.width>700}})})),1):s("div",{staticClass:"row q-col-gutter-x-md q-col-gutter-y-lg"},t._l(t.works,(function(e){return s("div",{key:e.id,staticClass:"col-xs-12 col-sm-6 col-md-4",class:t.detailMode?"col-lg-3 col-xl-3":"col-lg-2 col-xl-2"},[s("WorkCard",{staticClass:"fit",attrs:{metadata:e,thumbnailMode:!t.detailMode}})],1)})),0),s("div",{directives:[{name:"show",rawName:"v-show",value:t.stopLoad,expression:"stopLoad"}],staticClass:"q-mt-lg q-mb-xl text-h6 text-bold text-center"},[t._v("END")])],1)],1)])},te=[],ee=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-card",[s("router-link",{attrs:{to:"/work/"+t.metadata.id}},[s("CoverSFW",{attrs:{workid:t.metadata.id,nsfw:!1,release:t.metadata.release}})],1),s("q-separator"),t.thumbnailMode?t._e():s("div",[s("div",{staticClass:"q-mx-sm text-h6 text-weight-regular ellipsis-2-lines"},[s("router-link",{staticClass:"text-black",attrs:{to:"/work/"+t.metadata.id}},[t._v("\n        "+t._s(t.metadata.title)+"\n      ")])],1),s("div",{staticClass:"q-ml-sm q-mt-sm q-mb-xs text-subtitle1 text-weight-regular ellipsis"},[s("router-link",{staticClass:"text-grey",attrs:{to:"/works?circleId="+t.metadata.circle.id}},[t._v("\n        "+t._s(t.metadata.circle.name)+"\n      ")])],1),s("div",{staticClass:"q-ml-sm q-mt-sm q-mb-xs text-subtitle1 text-weight-regular ellipsis"},[s("router-link",{staticClass:"text-grey",attrs:{to:"/works?seriesId="+t.metadata.series.id}},[t._v("\n        "+t._s(t.metadata.series.name)+"\n      ")])],1),s("div",{directives:[{name:"show",rawName:"v-show",value:t.metadata.title,expression:"metadata.title"}],staticClass:"row items-center"},[s("div",{staticClass:"col-auto q-ml-sm"},[s("q-rating",{attrs:{size:"sm",color:t.userMarked?"blue":"amber",icon:"star_border","icon-selected":"star","icon-half":"star_half"},model:{value:t.rating,callback:function(e){t.rating=e},expression:"rating"}}),t.metadata.rate_count_detail?s("q-tooltip",{attrs:{"content-class":"text-subtitle1"}},[s("div",[t._v("平均: "+t._s(t.metadata.rate_average_2dp))]),t._l(t.sortedRatings,(function(e,a){return s("div",{key:a,staticClass:"row items-center"},[s("div",{staticClass:"col"},[t._v(t._s(e.review_point)+"星")]),s("q-linear-progress",{staticClass:"col-auto",staticStyle:{height:"15px",width:"100px"},attrs:{value:e.ratio/100,color:"amber","track-color":"white"}}),s("div",{staticClass:"col q-mx-sm"},[t._v("("+t._s(e.count)+")")])],1)}))],2):t._e()],1),s("div",{staticClass:"col-auto"},[s("span",{staticClass:"text-weight-medium text-body1 text-red"},[t._v(t._s(t.metadata.rate_average_2dp))]),s("span",{staticClass:"text-grey"},[t._v(" ("+t._s(t.metadata.rate_count)+")")])]),s("div",{staticClass:"col-auto q-px-sm"},[s("q-icon",{attrs:{name:"chat",size:"xs"}}),s("span",{staticClass:"text-grey"},[t._v(" ("+t._s(t.metadata.review_count)+")")])],1),s("div",{staticClass:"col-auto"},[s("q-icon",{attrs:{name:"launch",size:"xs"}}),s("a",{staticClass:"text-blue",attrs:{href:"https://www.dlsite.com/home/work/=/product_id/RJ"+String(t.metadata.id).padStart(6,"0")+".html",rel:"noreferrer noopener",target:"_blank"}},[t._v("DLsite")])],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.metadata.title,expression:"metadata.title"}]},[s("span",{staticClass:"q-mx-sm text-weight-medium text-h6 text-red"},[t._v(t._s(t.metadata.price)+" 日元")]),s("span",[t._v("售出数: "+t._s(t.metadata.dl_count))]),t.metadata.nsfw?t._e():s("span",{staticClass:"q-mx-sm",staticStyle:{background:"#e6f7d6",color:"#56842a"}},[t._v("全年龄")])]),t.showTags?s("div",{staticClass:"q-ma-xs"},t._l(t.metadata.tags,(function(e,a){return s("router-link",{key:a,attrs:{to:"/works?tagId="+e.id}},[s("q-chip",{staticClass:"shadow-2",attrs:{size:"md"}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)})),1):t._e(),s("div",{staticClass:"q-mx-xs q-my-sm"},t._l(t.metadata.vas,(function(e,a){return s("router-link",{key:a,attrs:{to:"/works?vaId="+e.id}},[s("q-chip",{staticClass:"shadow-2",attrs:{square:"",size:"md",color:"teal","text-color":"white"}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)})),1)])],1)},se=[],ae=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("router-link",{attrs:{to:"/work/"+t.workid}},[s("q-img",{staticStyle:{"max-width":"560px"},attrs:{src:t.coverUrl,ratio:4/3,"img-class":t.imgClass,transition:"fade"},on:{mouseover:function(e){return t.toggleBlurFlag()},mouseout:function(e){return t.toggleBlurFlag()}}},[s("div",{staticClass:"absolute-top-left transparent",staticStyle:{padding:"0"}},[s("q-chip",{staticClass:"q-ma-sm",attrs:{dense:"",square:"",color:"brown","text-color":"white"}},[t._v("\n        "+t._s("RJ"+t.rjcode)+"\n      ")])],1),s("div",{staticClass:"absolute-bottom-right",staticStyle:{padding:"5px"},attrs:{"v-if":t.release}},[t._v("\n      "+t._s(t.release)+"\n    ")])])],1)},re=[],ie={name:"CoverSFW",props:{workid:{type:Number,required:!0},nsfw:{type:Boolean,default:!0},release:{required:!0}},data(){return{blurFlag:!0}},computed:{coverUrl(){const t=this.$q.localStorage.getItem("jwt-token")||"";return this.workid?`/api/cover/${this.workid}?token=${t}`:""},rjcode(){return("000000"+this.workid).slice(-6)},imgClass(){return this.$q.platform.is.mobile?"":this.nsfw&&this.blurFlag?"blur-image":""}},methods:{toggleBlurFlag(){this.blurFlag=!this.blurFlag}}},oe=ie,ne=(s("1f5a"),s("b047")),le=Object(h["a"])(oe,ae,re,!1,null,null,null),ce=le.exports;G()(le,"components",{QImg:j["a"],QChip:ne["a"]});var de={name:"WorkCard",mixins:[rt],components:{CoverSFW:ce},props:{metadata:{type:Object,required:!0},thumbnailMode:{type:Boolean,default:!1}},data(){return{rating:0,userMarked:!1,showTags:!0}},computed:{sortedRatings:function(){function t(t,e){return t.review_point>e.review_point?-1:1}return this.metadata.rate_count_detail.slice().sort(t)}},mounted(){this.metadata.userRating?(this.userMarked=!0,this.rating=this.metadata.userRating):(this.userMarked=!1,this.rating=this.metadata.rate_average_2dp||0),this.metadata.tags&&null===this.metadata.tags[0].name&&(this.showTags=!1)},watch:{rating(t,e){if(e){const e={user_name:this.$store.state.User.name,work_id:this.metadata.id,rating:t};this.userMarked=!0,this.submitRating(e)}}},methods:{submitRating(t){this.$axios.put("/api/review",t).then(t=>{this.showSuccNotif(t.data.message)}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},ue=de,me=s("daf4"),pe=s("05c0"),he=s("6b1d"),ge=Object(h["a"])(ue,ee,se,!1,null,null,null),ve=ge.exports;G()(ge,"components",{QCard:ut["a"],QSeparator:vt["a"],QRating:me["a"],QTooltip:pe["a"],QLinearProgress:he["a"],QIcon:pt["a"],QChip:ne["a"]});var fe=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-item",{staticClass:"bg-white",staticStyle:{padding:"5px"},attrs:{clickable:"",to:"/work/"+t.metadata.id}},[s("q-item-section",{staticStyle:{padding:"0px 5px 0px 0px"},attrs:{avatar:""}},[s("router-link",{attrs:{to:"/work/"+t.metadata.id}},[s("q-img",{staticStyle:{height:"60px",width:"60px"},attrs:{transition:"fade",src:t.samCoverUrl}})],1)],1),s("q-item-section",[s("q-item-label",{staticClass:"text",attrs:{lines:"2"}},[s("router-link",{staticClass:"text-black",attrs:{to:"/work/"+t.metadata.id}},[t._v("\n        "+t._s(t.metadata.title)+"\n      ")])],1),s("q-item-label",[s("div",{staticClass:"row q-gutter-x-sm q-gutter-y-xs"},[s("router-link",{staticClass:"col-auto text-grey",attrs:{to:"/works?circleId="+t.metadata.circle.id}},[t._v("\n          "+t._s(t.metadata.circle.name)+"\n        ")]),s("router-link",{staticClass:"col-auto text-grey",attrs:{to:"/works?seriesId="+t.metadata.series.id}},[t._v("\n          "+t._s(t.metadata.series.name)+"\n        ")]),s("span",{staticClass:"col-auto"},[t._v("/")]),t._l(t.metadata.vas,(function(e,a){return s("router-link",{key:a,staticClass:"col-auto text-primary",attrs:{to:"/works?vaId="+e.id}},[t._v("\n          "+t._s(e.name)+"\n        ")])}))],2)]),t.showLabel&&t.$q.screen.width>700?s("q-item-label",[s("div",{staticClass:"row q-gutter-x-sm q-gutter-y-xs"},t._l(t.metadata.tags,(function(e,a){return s("router-link",{key:a,staticClass:"col-auto text-grey",attrs:{to:"/works?tagId="+e.id}},[t._v("\n          "+t._s(e.name)+"\n        ")])})),1)]):t._e()],1)],1)},we=[],qe={name:"WorkListItem",props:{metadata:{type:Object,required:!0},showLabel:{type:Boolean,default:!0}},computed:{samCoverUrl(){const t=this.$q.localStorage.getItem("jwt-token")||"";return this.metadata.id?`/api/cover/${this.metadata.id}?type=sam&token=${t}`:""}}},be=qe,ke=Object(h["a"])(be,fe,we,!1,null,null,null),_e=ke.exports;G()(ke,"components",{QItem:D["a"],QItemSection:F["a"],QImg:j["a"],QItemLabel:B["a"]});var ye={name:"Works",mixins:[rt],components:{WorkCard:ve,WorkListItem:_e},data(){return{listMode:!1,showLabel:!0,detailMode:!0,stopLoad:!1,works:[],pageTitle:"",page:1,pagination:{currentPage:0,pageSize:12,totalCount:0},seed:7,sortOption:{label:"按照发售日期新到老的顺序",order:"release",sort:"desc"},options:[{label:"按照发售日期新到老的顺序",order:"release",sort:"desc"},{label:"按照我的评价排序",order:"rating",sort:"desc"},{label:"按照发售日期老到新的顺序",order:"release",sort:"asc"},{label:"按照售出数量多到少的顺序",order:"dl_count",sort:"desc"},{label:"按照价格便宜到贵的顺序",order:"price",sort:"asc"},{label:"按照价格贵到便宜的顺序",order:"price",sort:"desc"},{label:"按照评价高到低的顺序",order:"rate_average_2dp",sort:"desc"},{label:"按照评论多到少的顺序",order:"review_count",sort:"desc"},{label:"按照RJ号大到小的顺序",order:"id",sort:"desc"},{label:"按照RJ号小到大的顺序",order:"id",sort:"asc"},{label:"按照全年龄新作优先的顺序",order:"nsfw",sort:"asc"},{label:"随机排序",order:"random",sort:"desc"}]}},created(){this.refreshPageTitle(),this.seed=Math.floor(100*Math.random())},mounted(){if(localStorage.sortOption)try{this.sortOption=JSON.parse(localStorage.sortOption)}catch{localStorage.removeItem("sortOption")}localStorage.showLabel&&(this.showLabel="true"===localStorage.showLabel),localStorage.listMode&&(this.listMode="true"===localStorage.listMode),localStorage.detailMode&&(this.detailMode="true"===localStorage.detailMode)},computed:{url(){const t=this.$route.query;return t.circleId?`/api/circles/${this.$route.query.circleId}/works`:t.seriesId?`/api/series/${this.$route.query.seriesId}/works`:t.tagId?`/api/tags/${this.$route.query.tagId}/works`:t.vaId?`/api/vas/${this.$route.query.vaId}/works`:t.keyword?"/api/search/"+t.keyword:"/api/works"}},activated(){this.stopLoad=!1},deactivated(){this.stopLoad=!0},watch:{url(){this.reset()},sortOption(t){localStorage.sortOption=JSON.stringify(t),this.seed=Math.floor(100*Math.random()),this.reset()},showLabel(t){localStorage.showLabel=t},listMode(t){localStorage.listMode=t},detailMode(t){localStorage.detailMode=t}},methods:{onLoad(t,e){this.requestWorksQueue().then(()=>e())},requestWorksQueue(){const t={order:this.sortOption.order,sort:this.sortOption.sort,page:this.pagination.currentPage+1||1,seed:this.seed};return this.$axios.get(this.url,{params:t}).then(e=>{const s=e.data.works;this.works=1===t.page?s.concat():this.works.concat(s),this.pagination=e.data.pagination,this.works.length>=this.pagination.totalCount&&(this.stopLoad=!0)}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t),this.stopLoad=!0})},refreshPageTitle(){if(this.$route.query.circleId||this.$route.query.seriesId||this.$route.query.tagId||this.$route.query.vaId){let t="",e="";this.$route.query.circleId?(e="circles",t=`/api/${e}/${this.$route.query.circleId}`):this.$route.query.seriesId?(e="series",t=`/api/${e}/${this.$route.query.seriesId}`):this.$route.query.tagId?(e="tags",t=`/api/${e}/${this.$route.query.tagId}`):(e="vas",t=`/api/${e}/${this.$route.query.vaId}`),this.$axios.get(t).then(t=>{const s=t.data.name;let a;switch(e){case"tags":a="Works tagged with ";break;case"vas":a="Works voiced by ";break;case"circles":a="Works by ";break;case"series":a="Works series by ";break}a+=s||"",this.pageTitle=a}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}else this.$route.query.keyword?this.pageTitle="Search by "+this.$route.query.keyword:this.pageTitle="All works"},reset(){this.stopLoad=!0,this.refreshPageTitle(),this.pagination={currentPage:0,pageSize:12,totalCount:0},this.requestWorksQueue().then(()=>{this.stopLoad=!1})}}},xe=ye,Se=(s("5a82"),s("ef35")),Ce=s("ddd8"),Te=s("6a67"),Ee=s("8380"),$e=Object(h["a"])(xe,Zt,te,!1,null,"7e9ab898",null),Ie=$e.exports;G()($e,"components",{QInfiniteScroll:Se["a"],QSelect:Ce["a"],QBtnToggle:Te["a"],QList:ft["a"],QSpinnerDots:Ee["a"]});var Pe=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("WorkDetails",{attrs:{metadata:t.metadata},on:{reset:function(e){return t.requestData()}}}),s("WorkTree",{attrs:{tree:t.tree,editable:!1}})],1)},Ne=[],Le=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("router-link",{attrs:{to:"/work/"+t.metadata.id}},[s("CoverSFW",{attrs:{workid:t.metadata.id,nsfw:!1,release:t.metadata.release}})],1),s("div",{staticClass:"q-pa-sm"},[s("div",{staticClass:"q-px-sm q-py-none"},[s("div",{staticClass:"text-h6 text-weight-regular"},[s("router-link",{staticClass:"text-black",attrs:{to:"/work/"+t.metadata.id}},[t._v("\n          "+t._s(t.metadata.title)+"\n        ")])],1),s("div",{staticClass:"text-subtitle1 text-weight-regular"},[s("router-link",{staticClass:"text-grey",attrs:{to:"/works?circleId="+t.metadata.circle.id}},[t._v("\n          "+t._s(t.metadata.circle.name)+"\n        ")])],1),s("div",{staticClass:"text-subtitle1 text-weight-regular"},[s("router-link",{staticClass:"text-grey",attrs:{to:"/works?seriesId="+t.metadata.series.id}},[t._v("\n          "+t._s(t.metadata.series.name)+"\n        ")])],1),s("div",{staticClass:"row items-center q-gutter-xs"},[s("div",{staticClass:"col-auto"},[s("q-rating",{attrs:{name:"rating",size:"sm",color:t.userMarked?"blue":"amber",icon:"star_border","icon-selected":"star","icon-half":"star_half"},on:{input:t.setRating},model:{value:t.rating,callback:function(e){t.rating=e},expression:"rating"}}),t.metadata.rate_count_detail?s("q-tooltip",{attrs:{"content-class":"text-subtitle1"}},[s("div",[t._v("平均: "+t._s(t.metadata.rate_average_2dp))]),t._l(t.sortedRatings,(function(e,a){return s("div",{key:a,staticClass:"row items-center"},[s("div",{staticClass:"col"},[t._v(" "+t._s(e.review_point)+"星 ")]),s("q-linear-progress",{staticClass:"col-auto",staticStyle:{height:"15px",width:"100px"},attrs:{value:e.ratio/100,color:"amber","track-color":"white"}}),s("div",{staticClass:"col q-mx-sm"},[t._v(" ("+t._s(e.count)+") ")])],1)}))],2):t._e()],1),s("div",{staticClass:"col-auto"},[s("span",{staticClass:"text-weight-medium text-body1 text-red"},[t._v(t._s(t.metadata.rate_average_2dp))]),s("span",{staticClass:"text-grey"},[t._v(" ("+t._s(t.metadata.rate_count)+")")])]),s("div",{staticClass:"col-auto q-px-sm"},[s("q-icon",{attrs:{name:"chat",size:"xs"}}),s("span",{staticClass:"text-grey"},[t._v(" ("+t._s(t.metadata.review_count)+")")])],1),s("div",{staticClass:"col-auto"},[s("q-icon",{attrs:{name:"launch",size:"xs"}}),s("a",{staticClass:"text-blue",attrs:{href:"https://www.dlsite.com/home/work/=/product_id/RJ"+String(t.metadata.id).padStart(6,"0")+".html",rel:"noreferrer noopener",target:"_blank"}},[t._v("DLsite")])],1)])]),s("div",{staticClass:"q-pt-sm q-pb-none"},[s("span",{staticClass:"q-mx-sm text-weight-medium text-h6 text-red"},[t._v(t._s(t.metadata.price)+" 日元")]),t._v(" 售出数: "+t._s(t.metadata.dl_count)+"\n    ")]),t.showTags?s("div",{staticClass:"q-px-none q-py-sm"},t._l(t.metadata.tags,(function(e,a){return s("router-link",{key:a,attrs:{to:"/works?tagId="+e.id}},[s("q-chip",{staticClass:"shadow-4",attrs:{size:"md"}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)})),1):t._e(),s("div",{staticClass:"q-px-none q-pt-sm q-py-sm"},t._l(t.metadata.vas,(function(e,a){return s("router-link",{key:a,attrs:{to:"/works?vaId="+e.id}},[s("q-chip",{staticClass:"shadow-4",attrs:{square:"",size:"md",color:"teal","text-color":"white"}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)})),1),s("q-btn-dropdown",{staticClass:"q-mt-sm shadow-4 q-mx-xs q-pl-sm",attrs:{dense:"",color:"cyan",label:"标记进度"}},[s("q-list",[s("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("marked")}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"marked"===t.progress,expression:"progress === 'marked'"}],attrs:{icon:"headset"}})],1),s("q-item-section",[s("q-item-label",[t._v("想听")])],1)],1),s("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("listening")}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"listening"===t.progress,expression:"progress === 'listening'"}],attrs:{icon:"headset"}})],1),s("q-item-section",[s("q-item-label",[t._v("在听")])],1)],1),s("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("listened")}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"listened"===t.progress,expression:"progress === 'listened'"}],attrs:{icon:"headset"}})],1),s("q-item-section",[s("q-item-label",[t._v("听过")])],1)],1),s("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("replay")}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"replay"===t.progress,expression:"progress === 'replay'"}],attrs:{icon:"headset"}})],1),s("q-item-section",[s("q-item-label",[t._v("重听")])],1)],1),s("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("postponed")}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"postponed"===t.progress,expression:"progress === 'postponed'"}],attrs:{icon:"headset"}})],1),s("q-item-section",[s("q-item-label",[t._v("搁置")])],1)],1)],1)],1),s("q-btn",{attrs:{dense:"",color:"cyan q-mt-sm shadow-4 q-mx-xs q-px-sm",label:"写评论"},on:{click:function(e){t.showReviewDialog=!0}}}),t.showReviewDialog?s("WriteReview",{attrs:{workid:t.metadata.id,metadata:t.metadata},on:{closed:t.processReview}}):t._e()],1)],1)},Qe=[],Re=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("q-dialog",{on:{hide:t.closeDialog},model:{value:t.showReviewDialog,callback:function(e){t.showReviewDialog=e},expression:"showReviewDialog"}},[s("q-card",[s("q-card-section",{staticClass:"q-pb-sm"},[s("div",{staticClass:"text-body1"},[t._v("我的评论")])]),s("q-card-section",{staticClass:"q-pt-none"},[s("q-rating",{staticClass:"col-auto",attrs:{size:"sm",color:"blue",icon:"star_border","icon-selected":"star","icon-half":"star_half"},model:{value:t.rating,callback:function(e){t.rating=e},expression:"rating"}}),s("q-btn-toggle",{class:t.$q.screen.lt.sm?"my-custom-toggle q-mx-none q-mt-sm":"my-custom-toggle q-mx-md",attrs:{"no-caps":"",rounded:"",unelevated:"",padding:t.$q.screen.width<400?"sm":"","toggle-color":"primary",color:"white","text-color":"primary",options:[{label:"想听",value:"marked"},{label:"在听",value:"listening"},{label:"听过",value:"listened"},{label:"重听",value:"replay"},{label:"搁置",value:"postponed"}]},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}})],1),s("q-card-section",{staticClass:"q-pt-none"},[s("div",{staticStyle:{"min-width":"300px"}},[s("q-input",{attrs:{filled:"",type:"textarea"},model:{value:t.reviewText,callback:function(e){t.reviewText=e},expression:"reviewText"}})],1)]),s("div",{staticClass:"row justify-between"},[s("q-card-actions",{staticClass:"text-red"},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"删除标记"},on:{click:function(e){t.deleteConfirm=!0}}})],1),s("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确定"},on:{click:function(e){return t.submitReview()}}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"},on:{click:function(e){return t.closeDialog()}}})],1)],1)],1)],1),s("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:t.deleteConfirm,callback:function(e){t.deleteConfirm=e},expression:"deleteConfirm"}},[s("q-card",{staticClass:"bg-teal text-white",staticStyle:{width:"300px"}},[s("q-card-section",[s("div",{staticClass:"text-h6"},[t._v("确定要删除标记吗")])]),s("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确定"},on:{click:function(e){return t.deleteReview()}}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"},on:{click:function(e){return t.closeDialog()}}})],1)],1)],1)],1)},Ae=[],Me={name:"WriteReview",mixins:[rt],props:{workid:{type:Number,required:!0},metadata:{type:Object,default:null}},data(){return{showReviewDialog:!0,deleteConfirm:!1,rating:0,reviewText:"",modified:!1,progress:""}},mounted(){this.metadata.userRating&&(this.rating=this.metadata.userRating),this.progress=this.metadata.progress,this.reviewText=this.metadata.review_text},methods:{closeDialog(){this.deleteConfirm||(this.modified?this.$emit("closed",!0):this.$emit("closed",!1))},reviewPayload(){const t={user_name:this.$store.state.User.name,work_id:this.workid,rating:this.rating,review_text:this.reviewText,progress:this.progress};return t},submitReview(){const t={starOnly:!1},e=this.reviewPayload();this.$axios.put("/api/review",e,{params:t}).then(t=>{this.modified=!0,this.showSuccNotif(t.data.message)}).then(()=>this.closeDialog()).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},deleteReview(){const t={work_id:this.workid};this.$axios.delete("/api/review",{params:t}).then(t=>{this.modified=!0,this.showSuccNotif(t.data.message)}).then(()=>this.closeDialog()).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},Oe=Me,Ue=(s("6ad7"),Object(h["a"])(Oe,Re,Ae,!1,null,"178028d5",null)),De=Ue.exports;G()(Ue,"components",{QDialog:ht["a"],QCard:ut["a"],QCardSection:zt["a"],QRating:me["a"],QBtnToggle:Te["a"],QInput:jt["a"],QCardActions:Lt["a"],QBtn:W["a"]}),G()(Ue,"directives",{ClosePopup:wt["a"]});var Fe={name:"WorkDetails",mixins:[rt],components:{CoverSFW:ce,WriteReview:De},props:{metadata:{type:Object,required:!0}},data(){return{rating:0,userMarked:!1,progress:"",showReviewDialog:!1,showTags:!0}},computed:{sortedRatings:function(){function t(t,e){return t.review_point>e.review_point?-1:1}return this.metadata.rate_count_detail.slice().sort(t)}},watch:{metadata(t){t.userRating?(this.userMarked=!0,this.rating=t.userRating):(this.userMarked=!1,this.rating=t.rate_average_2dp||0),this.progress=t.progress,t.tags&&null===t.tags[0].name&&(this.showTags=!1)}},methods:{setProgress(t){this.progress=t;const e={user_name:this.$store.state.User.name,work_id:this.metadata.id,progress:t};this.submitProgress(e)},submitProgress(t){const e={starOnly:!1,progressOnly:!0};this.$axios.put("/api/review",t,{params:e}).then(t=>{this.showSuccNotif(t.data.message),this.$emit("reset")}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},setRating(t){const e={user_name:this.$store.state.User.name,work_id:this.metadata.id,rating:t};this.submitRating(e)},submitRating(t){this.$axios.put("/api/review",t).then(t=>{this.showSuccNotif(t.data.message),this.$emit("reset")}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},processReview(){this.showReviewDialog=!1}}},je=Fe,Be=s("f20b"),We=Object(h["a"])(je,Le,Qe,!1,null,null,null),ze=We.exports;G()(We,"components",{QRating:me["a"],QTooltip:pe["a"],QLinearProgress:he["a"],QIcon:pt["a"],QChip:ne["a"],QBtnDropdown:Be["a"],QList:ft["a"],QItem:D["a"],QItemSection:F["a"],QAvatar:Kt["a"],QItemLabel:B["a"],QBtn:W["a"]});var Ke=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"q-ma-md "},[t.path.length?s("q-breadcrumbs",{attrs:{gutter:"xs"}},[s("q-breadcrumbs-el",[s("q-btn",{staticStyle:{height:"30px"},attrs:{"no-caps":"",flat:"",dense:"",size:"md",icon:"folder"},on:{click:function(e){t.path=[]}}},[t._v("ROOT")])],1),t._l(t.path,(function(e,a){return s("q-breadcrumbs-el",{key:a,staticClass:"cursor-pointer"},[s("q-btn",{staticStyle:{height:"30px"},attrs:{"no-caps":"",flat:"",dense:"",size:"md",icon:"folder"},on:{click:function(e){return t.onClickBreadcrumb(a)}}},[t._v(t._s(e))])],1)}))],2):t._e(),s("q-card",[s("q-list",{attrs:{separator:""}},t._l(t.fatherFolder,(function(e,a){return s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a,staticClass:"non-selectable",attrs:{clickable:"",active:"audio"===e.type&&t.currentPlayingFile.hash===e.hash,"active-class":"text-white bg-teal"},on:{click:function(s){return t.onClickItem(e)}}},[s("q-item-section",{attrs:{avatar:""}},["folder"===e.type?s("q-icon",{attrs:{size:"34px",color:"amber",name:"folder"}}):"text"===e.type?s("q-icon",{attrs:{size:"34px",color:"info",name:"description"}}):"image"===e.type?s("q-icon",{attrs:{size:"34px",color:"orange",name:"photo"}}):"other"===e.type?s("q-icon",{attrs:{size:"34px",color:"info",name:"description"}}):s("q-btn",{attrs:{round:"",dense:"",color:"primary",icon:t.playIcon(e.hash)},on:{click:function(s){return t.onClickPlayButton(e.hash)}}})],1),s("q-item-section",[s("q-item-label",{attrs:{lines:"2"}},[t._v(t._s(e.title))]),e.children?s("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(e.children.length+" 项目"))]):t._e()],1),"audio"===e.type||"text"===e.type||"image"===e.type||"other"===e.type?s("q-menu",{attrs:{"touch-position":"","context-menu":"","auto-close":"","transition-show":"jump-down","transition-hide":"jump-up"}},[s("q-list",{attrs:{separator:""}},["audio"===e.type?s("q-item",{attrs:{clickable:""},on:{click:function(s){return t.addToQueue(e)}}},[s("q-item-section",[t._v("添加到播放列表")])],1):t._e(),"audio"===e.type?s("q-item",{attrs:{clickable:""},on:{click:function(s){return t.playNext(e)}}},[s("q-item-section",[t._v("下一曲播放")])],1):t._e(),s("q-item",{attrs:{clickable:""},on:{click:function(s){return t.download(e)}}},[s("q-item-section",[t._v("下载文件")])],1)],1)],1):t._e()],1)})),1)],1)],1)},Ge=[],He={name:"WorkTree",data(){return{path:[]}},props:{tree:{type:Array,required:!0}},watch:{tree(){this.initPath()}},computed:{fatherFolder(){let t=this.tree.concat();return this.path.forEach(e=>{t=t.find(t=>"folder"===t.type&&t.title===e).children}),t},queue(){const t=[];return this.fatherFolder.forEach(e=>{"audio"===e.type&&t.push(e)}),t},...Object(f["d"])("AudioPlayer",["playing"]),...Object(f["b"])("AudioPlayer",["currentPlayingFile"])},methods:{playIcon(t){return this.playing&&this.currentPlayingFile.hash===t?"pause":"play_arrow"},initPath(){const t=[];let e=this.tree.concat();while(1===e.length){if("audio"===e[0].type)break;t.push(e[0].title),e=e[0].children}this.path=t},onClickBreadcrumb(t){this.path=this.path.slice(0,t+1)},onClickItem(t){"folder"===t.type?this.path.push(t.title):"text"===t.type||"image"===t.type?this.openFile(t):"other"===t.type?this.download(t):this.currentPlayingFile.hash!==t.hash&&this.$store.commit("AudioPlayer/SET_QUEUE",{queue:this.queue.concat(),index:this.queue.findIndex(e=>e.hash===t.hash),resetPlaying:!0})},onClickPlayButton(t){this.currentPlayingFile.hash===t?this.$store.commit("AudioPlayer/TOGGLE_PLAYING"):this.$store.commit("AudioPlayer/SET_QUEUE",{queue:this.queue.concat(),index:this.queue.findIndex(e=>e.hash===t),resetPlaying:!0})},addToQueue(t){this.$store.commit("AudioPlayer/ADD_TO_QUEUE",t)},playNext(t){this.$store.commit("AudioPlayer/PLAY_NEXT",t)},download(t){const e=this.$q.localStorage.getItem("jwt-token")||"",s=t.mediaDownloadUrl?`${t.mediaDownloadUrl}?token=${e}`:`/api/media/download/${t.hash}?token=${e}`,a=document.createElement("a");a.href=s,a.target="_blank",a.click()},openFile(t){const e=this.$q.localStorage.getItem("jwt-token")||"",s=t.mediaStreamUrl?`${t.mediaStreamUrl}?token=${e}`:`/api/media/stream/${t.hash}?token=${e}`,a=document.createElement("a");a.href=s,a.target="_blank",a.click()}}},Ye=He,Ve=s("ead5"),Je=s("079e"),Xe=Object(h["a"])(Ye,Ke,Ge,!1,null,null,null),Ze=Xe.exports;G()(Xe,"components",{QBreadcrumbs:Ve["a"],QBreadcrumbsEl:Je["a"],QBtn:W["a"],QCard:ut["a"],QList:ft["a"],QItem:D["a"],QItemSection:F["a"],QIcon:pt["a"],QItemLabel:B["a"],QMenu:mt["a"]}),G()(Xe,"directives",{Ripple:z["a"]});var ts={name:"Work",mixins:[rt],components:{WorkDetails:ze,WorkTree:Ze},data(){return{workid:this.$route.params.id,metadata:{id:parseInt(this.$route.params.id),circle:{},series:{}},tree:[]}},watch:{$route(t){this.workid=t.params.id,this.requestData()}},created(){this.requestData()},methods:{requestData(){this.$axios.get("/api/work/"+this.workid).then(t=>{this.metadata=t.data}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)}),this.$axios.get("/api/tracks/"+this.workid).then(t=>{this.tree=t.data}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},es=ts,ss=Object(h["a"])(es,Pe,Ne,!1,null,null,null),as=ss.exports,rs=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"text-h5 text-weight-regular q-ma-md"},[t._v("\n    All "+t._s(t.restrict)+"s\n  ")]),s("div",{staticClass:"row justify-center q-pb-xl q-pt-none"},[s("div",{staticClass:"col-11"},[s("q-input",{staticClass:"q-mb-md",attrs:{dense:"",rounded:"",outlined:"",placeholder:"Search for a "+t.restrict+"..."},scopedSlots:t._u([{key:"append",fn:function(){return[""===t.keyword?s("q-icon",{attrs:{name:"search"}}):s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"clear"},on:{click:function(e){t.keyword=""}}})]},proxy:!0}]),model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),s("div",{staticClass:"row justify-center q-gutter-sm"},t._l(t.keyword?t.filteredItems:t.items,(function(e){return s("div",{key:e.id,staticClass:"col-auto"},[s("q-btn",{attrs:{"no-caps":"",rounded:"",color:"primary",label:e.name+" ("+e.count+")",to:"/works?"+t.queryField+"="+e.id}})],1)})),0)],1)])])},is=[],os={name:"List",mixins:[rt],props:{restrict:{type:String}},data(){return{items:[],keyword:""}},created(){this.requestList()},computed:{url(){return`/api/${this.restrict}/`},queryField(){switch(this.restrict){case"circles":return"circleId";case"series":return"seriesId";case"tags":return"tagId";case"vas":return"vaId";default:return"circleId"}},filteredItems(){return this.items.filter(t=>-1!==t.name.toLowerCase().indexOf(this.keyword.toLowerCase()))}},watch:{url(){this.requestList()}},methods:{requestList(){this.$axios.get(this.url).then(t=>{this.items=t.data.concat()}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},ns=os,ls=Object(h["a"])(ns,rs,is,!1,null,null,null),cs=ls.exports;G()(ls,"components",{QInput:jt["a"],QIcon:pt["a"],QBtn:W["a"]});var ds=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-form",{staticClass:"absolute-center\tq-gutter-md",staticStyle:{width:"260px"},on:{submit:t.onSubmit}},[s("q-input",{staticClass:"fit",attrs:{filled:"",label:"用户名","lazy-rules":"",rules:[function(t){return t.length>=5||"密码长度至少为 5"}]},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),s("q-input",{staticClass:"fit",attrs:{filled:"",type:"password",label:"密码","lazy-rules":"",rules:[function(t){return t.length>=5||"密码长度至少为 5"}]},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),s("q-btn",{staticClass:"fit",attrs:{label:"登录",type:"submit",color:"primary"}})],1)},us=[],ms=s("bc3a"),ps=s.n(ms);function hs(t){ps.a.defaults.headers["Authorization"]="Bearer "+t}ps.a.defaults.headers["Content-Type"]="application/json",ps.a.defaults.headers["Authorization"]=n["a"].getItem("jwt-token")?"Bearer "+n["a"].getItem("jwt-token"):"",a["default"].prototype.$axios=ps.a;var gs={mixins:[rt],data(){return{name:"",password:""}},methods:{onSubmit(){this.$axios.post("/api/auth/me",{name:this.name,password:this.password}).then(t=>{try{this.$q.localStorage.set("jwt-token",t.data.token),hs(t.data.token),this.showSuccNotif("登录成功."),this.$router.push("/")}catch(e){this.showErrNotif(e.message)}}).catch(t=>{t.response?401===t.response.status?this.showWarnNotif(t.response.data.error):this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},vs=gs,fs=s("0378"),ws=Object(h["a"])(vs,ds,us,!1,null,null,null),qs=ws.exports;G()(ws,"components",{QForm:fs["a"],QInput:jt["a"],QBtn:W["a"]});var bs=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{attrs:{padding:""}},[s("div",{staticClass:"fit row wrap justify-between items-start q-px-sm"},[s("div",{staticClass:"col-lg-3 col-sm-12 col-xs-12"},[s("q-btn-toggle",{staticClass:"text-bold",attrs:{spread:"","no-caps":"",rounded:"","toggle-color":"primary",color:"white","text-color":"black",options:[{label:"我的评价",value:"review"},{label:"我的进度",value:"progress"},{label:"分类整理",value:"folder"}]},on:{input:t.changeMode},model:{value:t.mode,callback:function(e){t.mode=e},expression:"mode"}})],1),s("div",{staticClass:"col-auto gt-sm row"},[s("q-select",{staticClass:"q-mx-sm",attrs:{dense:"",rounded:"",outlined:"",options:t.sortOptions,"bg-color":"white"},model:{value:t.sortBy,callback:function(e){t.sortBy=e},expression:"sortBy"}}),s("q-btn",{attrs:{disable:t.sortButtonDisabled,dense:"",rounded:"",color:"white","text-color":t.sortButtonDisabled?"grey":"black",icon:t.direction?"arrow_downward":"arrow_upward"},on:{click:t.switchSortMode}})],1)]),s("div",{staticClass:"q-pt-md q-px-sm"},["progress"===t.mode?s("q-btn-toggle",{attrs:{"toggle-color":"primary",color:"white","text-color":"black",rounded:"",options:[{label:"想听",value:"marked"},{label:"在听",value:"listening"},{label:"听过",value:"listened"},{label:"重听",value:"replay"},{label:"搁置",value:"postponed"}]},on:{input:t.changeProgressFilter},model:{value:t.progressFilter,callback:function(e){t.progressFilter=e},expression:"progressFilter"}}):t._e()],1),s("div",{staticClass:"q-pt-md"},[s("div",{staticClass:"q-px-sm q-py-md"},["folder"!==t.mode?s("q-infinite-scroll",{ref:"scroll",attrs:{offset:500,disable:t.stopLoad},on:{load:t.onLoad},scopedSlots:t._u([{key:"loading",fn:function(){return[s("div",{staticClass:"row justify-center q-my-md"},[s("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}],null,!1,3159847669)},[0===t.works.length?s("div",{staticClass:"row justify-center text-grey"},[t._v("在作品界面上点击星标、标记进度，标记的音声就会出现在这里啦")]):t._e(),t.works.length?s("q-list",{staticClass:"shadow-2",attrs:{bordered:"",separator:""}},t._l(t.works,(function(e){return s("FavListItem",{key:e.id,attrs:{workid:e.id,metadata:e,mode:t.mode},on:{reset:function(e){return t.reset()}}})})),1):t._e()],1):s("div",{staticClass:"row justify-center text-grey"},[t._v("尚未实现，敬请期待")])],1)])])},ks=[],_s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-item",{staticClass:"row bg-white",attrs:{clickable:""}},[s("q-item-section",{staticClass:"col-auto",attrs:{top:""}},[s("router-link",{attrs:{to:"/work/"+t.metadata.id}},[s("q-img",{staticStyle:{height:"120px",width:"160px"},attrs:{transition:"fade",src:t.coverUrl}})],1)],1),s("q-item-section",{staticClass:"q-gutter-y-xs column items-start",attrs:{top:""},on:{click:function(e){if(e.target!==e.currentTarget)return null;t.showReviewDialog=!0}}},[s("q-item-label",{staticClass:"text-body2",attrs:{lines:"2"}},[s("router-link",{staticClass:"col-auto text-black",attrs:{to:"/work/"+t.metadata.id}},[t._v("\n          "+t._s(t.metadata.title)+"\n        ")])],1),s("div",{staticClass:"row q-gutter-x-sm col-auto"},[s("router-link",{staticClass:"col-auto text-grey",attrs:{to:"/works?circleId="+t.metadata.circle.id}},[t._v("\n          "+t._s(t.metadata.circle.name)+"\n        ")]),s("router-link",{staticClass:"col-auto text-grey",attrs:{to:"/works?seriesId="+t.metadata.series.id}},[t._v("\n          "+t._s(t.metadata.series.name)+"\n        ")]),s("span",{staticClass:"col-auto"},[t._v("/")]),s("span",{staticClass:"col-auto text-grey"},[t._v(" "+t._s(t.metadata.release))]),s("span",{staticClass:"col-auto"},[t._v("/")]),t._l(t.metadata.vas,(function(e,a){return s("router-link",{key:a,staticClass:"col-auto text-primary",attrs:{to:"/works?vaId="+e.id}},[t._v("\n          "+t._s(e.name)+"\n        ")])}))],2),s("div",{staticClass:"row items-center q-gutter-x-xs"},[t.hideRating?t._e():s("q-rating",{staticClass:"col-auto",attrs:{size:"sm",color:"blue",icon:"star_border","icon-selected":"star","icon-half":"star_half"},on:{input:t.setRating},model:{value:t.rating,callback:function(e){t.rating=e},expression:"rating"}}),s("span",{staticClass:"col-auto text-grey "},[t._v(t._s(t.metadata.updated_at))])],1),"review"===t.mode?s("q-item-label",{staticClass:"q-pt-sm"},[s("q-card",{directives:[{name:"show",rawName:"v-show",value:t.metadata.review_text,expression:"metadata.review_text"}],staticClass:"my-card col-auto",on:{click:function(e){t.showReviewDialog=!0}}},[s("q-card-section",{staticClass:"q-pa-sm"},[s("pre",{staticClass:"q-ma-none"},[t._v(t._s(t.metadata.review_text))])])],1)],1):t._e(),"progress"===t.mode?s("q-item-label",{staticClass:"q-pt-xs"},["progress"===t.mode?s("q-btn-toggle",{staticClass:"q-pa-sm",attrs:{dense:"","no-caps":"",rounded:"","toggle-color":"primary",color:"white","text-color":"black",options:[{label:"想听",value:"marked"},{label:"在听",value:"listening"},{label:"听过",value:"listened"},{label:"重听",value:"replay"},{label:"搁置",value:"postponed"}]},on:{input:t.setProgress},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}}):t._e()],1):t._e()],1),t.showReviewDialog?s("WriteReview",{attrs:{workid:t.workid,metadata:t.metadata},on:{closed:t.processReview}}):t._e()],1)},ys=[],xs={name:"FavListItem",mixins:[rt],components:{WriteReview:De},props:{workid:{type:Number,required:!0},metadata:{type:Object,required:!0},mode:{type:String,default:"review"}},data(){return{rating:0,showReviewDialog:!1,hideRating:!1,progress:""}},computed:{coverUrl(){const t=this.$q.localStorage.getItem("jwt-token")||"";return this.workid?`/api/cover/${this.workid}?type=240x240&token=${t}`:""}},mounted(){this.setMetadata()},watch:{metadata(){this.setMetadata()}},methods:{setMetadata(){this.metadata.userRating?this.rating=this.metadata.userRating:this.hideRating=!0,this.rating?this.hideRating=!1:this.hideRating=!0,this.progress=this.metadata.progress},processReview(t){t&&(this.calledFromChild=!0,this.$emit("reset")),this.showReviewDialog=!1},setRating(t){if(t){const e={user_name:this.$store.state.User.name,work_id:this.metadata.id,rating:t};this.submitRating(e)}},submitRating(t){const e={starOnly:!0};this.$axios.put("/api/review",t,{params:e}).then(t=>{this.showSuccNotif(t.data.message)}).then(()=>this.$emit("reset")).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},setProgress(t){const e={user_name:this.$store.state.User.name,work_id:this.metadata.id,progress:t};this.submitProgress(e)},submitProgress(t){const e={starOnly:!1,progressOnly:!0};this.$axios.put("/api/review",t,{params:e}).then(t=>{this.showSuccNotif(t.data.message)}).then(()=>this.$emit("reset")).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},Ss=xs,Cs=Object(h["a"])(Ss,_s,ys,!1,null,null,null),Ts=Cs.exports;G()(Cs,"components",{QItem:D["a"],QItemSection:F["a"],QImg:j["a"],QItemLabel:B["a"],QRating:me["a"],QCard:ut["a"],QCardSection:zt["a"],QBtnToggle:Te["a"]});var Es={name:"Favourites",mixins:[rt],components:{FavListItem:Ts},props:{route:{type:String,default:"review"},progress:{type:String,default:"marked"}},computed:{direction(){return"desc"===this.sortMode},sortButtonDisabled(){return"allage"===this.sortBy.order||"nsfw"===this.sortBy.order}},data(){return{mode:"review",progressFilter:"marked",works:[],stopLoad:!1,pagination:{currentPage:0,pageSize:12,totalCount:0},sortMode:"desc",sortBy:{label:"标记时间",order:"updated_at"},sortOptions:[{label:"标记时间",order:"updated_at"},{label:"评价",order:"userRating"},{label:"发布时间",order:"release"},{label:"评论数量",order:"review_count"},{label:"售出数量",order:"dl_count"},{label:"全年龄新作",order:"allage"},{label:"18禁新作",order:"nsfw"}]}},created(){this.mode=this.route,this.progressFilter=this.progress},mounted(){if(localStorage.sortByFavourites)try{this.sortBy=JSON.parse(localStorage.sortByFavourites)}catch{localStorage.removeItem("sortByFavourites")}},watch:{sortBy(t){localStorage.sortByFavourites=JSON.stringify(t),this.reset()},sortMode(){this.reset()},route(){this.mode=this.route,this.reset()},progress(){this.progressFilter=this.progress,this.reset()}},methods:{changeMode(t){this.$router.push("/favourites/"+t),this.reset()},changeProgressFilter(t){this.$router.push("/favourites/progress/"+t),this.reset()},switchSortMode(){"desc"===this.sortMode?this.sortMode="asc":this.sortMode="desc"},onLoad(t,e){this.requestWorksQueue().then(()=>e())},reset(){this.stopLoad=!0,this.pagination={currentPage:0,pageSize:12,totalCount:0},this.requestWorksQueue().then(()=>{this.stopLoad=!1})},requestWorksQueue(){const t={order:this.sortBy.order,sort:this.sortMode,page:this.pagination.currentPage+1||1};return"allage"===this.sortBy.order&&(t.order="nsfw",t.sort="asc"),"nsfw"===this.sortBy.order&&(t.order="nsfw",t.sort="desc"),"progress"===this.mode&&(t.filter=this.progressFilter),this.$axios.get("/api/review",{params:t}).then(e=>{const s=e.data.works;this.works=1===t.page?s.concat():this.works.concat(s),this.pagination=e.data.pagination,this.works.length>=this.pagination.totalCount&&(this.stopLoad=!0)}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t),this.stopLoad=!0})}}},$s=Es,Is=Object(h["a"])($s,bs,ks,!1,null,null,null),Ps=Is.exports;G()(Is,"components",{QPage:Ht["a"],QBtnToggle:Te["a"],QSelect:Ce["a"],QBtn:W["a"],QInfiniteScroll:Se["a"],QList:ft["a"],QSpinnerDots:Ee["a"]});var Ns=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("q-card",{staticClass:"q-ma-md"},[s("q-form",{on:{submit:t.onSubmitRootFolder}},[s("q-toolbar",[s("q-toolbar-title",[t._v("添加新文件夹")])],1),s("div",{staticClass:"q-pa-sm"},[s("q-input",{attrs:{outlined:"",dense:"",required:"","lazy-rules":"",rules:[function(e){return!t.config.rootFolders.find((function(t){return t.name===e}))||"该别名已存在，文件夹别名不能重复"}],label:"文件夹别名"},model:{value:t.rootFolder.name,callback:function(e){t.$set(t.rootFolder,"name",e)},expression:"rootFolder.name"}}),s("q-input",{attrs:{outlined:"",dense:"",required:"","lazy-rules":"",rules:[function(e){return!t.config.rootFolders.find((function(t){return t.path===e}))||"该路径已存在，文件夹路径不能重复"}],label:"绝对路径"},model:{value:t.rootFolder.path,callback:function(e){t.$set(t.rootFolder,"path",e)},expression:"rootFolder.path"}}),s("div",{staticClass:"row justify-end"},[s("q-btn",{attrs:{type:"submit",color:"primary",label:"添加"}})],1)],1)],1)],1),s("q-form",{on:{submit:t.onSubmit}},[s("q-card",{directives:[{name:"show",rawName:"v-show",value:t.config.rootFolders.length,expression:"config.rootFolders.length"}],staticClass:"q-ma-md"},[s("q-toolbar",[s("q-toolbar-title",[t._v("文件夹列表")])],1),s("q-list",t._l(t.config.rootFolders,(function(e){return s("q-item",{key:e.name},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{color:"amber",name:"folder"}})],1),s("q-item-section",[s("q-item-label",[t._v(t._s(e.name))]),s("q-item-label",{attrs:{caption:""}},[t._v(t._s(e.path))])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-btn",{attrs:{flat:"",round:"",color:"red",icon:"delete"},on:{click:function(e){return t.removeFromRootFolders(t.index)}}})],1)],1)})),1)],1),s("q-card",{staticClass:"q-ma-md"},[s("q-toolbar",[s("q-toolbar-title",[t._v("封面文件夹路径")])],1),t.config.coverUseDefaultPath?s("div",{staticClass:"q-pa-md"},[t._v("已指定为默认路径，即程序所在位置下的covers文件夹。如需修改，请前往高级设置并取消“封面使用默认路径”。")]):s("q-input",{staticClass:"q-pa-sm",attrs:{outlined:"",dense:"",required:""},model:{value:t.config.coverFolderDir,callback:function(e){t.$set(t.config,"coverFolderDir",e)},expression:"config.coverFolderDir"}})],1),s("div",{staticClass:"q-ma-lg row justify-end"},[s("q-btn",{attrs:{loading:t.loading,label:"保存",type:"submit",color:"primary"}})],1)],1)],1)},Ls=[],Qs={name:"Folders",mixins:[rt],data(){return{config:{rootFolders:[]},rootFolder:{name:"",path:""},loading:!1}},methods:{requestConfig(){this.$axios.get("/api/config/admin").then(t=>{this.config=t.data.config,this.rootFolder.path=t.data.config.voiceWorkDefaultPath}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},onSubmit(){this.loading=!0,this.$axios.put("/api/config/admin",{config:this.config}).then(t=>{this.showSuccNotif(t.data.message),this.loading=!1}).catch(t=>{this.loading=!1,t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},onSubmitRootFolder(){""!==this.rootFolder.name&&""!==this.rootFolder.path&&(this.config.rootFolders.push({name:this.rootFolder.name,path:this.rootFolder.path}),this.rootFolder.name="",this.rootFolder.path="",this.onSubmit())},removeFromRootFolders(t){this.config.rootFolders.splice(t,1),this.onSubmit()}},created(){this.requestConfig()}},Rs=Qs,As=Object(h["a"])(Rs,Ns,Ls,!1,null,null,null),Ms=As.exports;G()(As,"components",{QCard:ut["a"],QForm:fs["a"],QToolbar:Dt["a"],QToolbarTitle:Ft["a"],QInput:jt["a"],QBtn:W["a"],QList:ft["a"],QItem:D["a"],QItemSection:F["a"],QIcon:pt["a"],QItemLabel:B["a"]});var Os=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"row q-ma-sm"},[s("div",{staticClass:"col-xs-6 col-sm-4 row q-pa-sm"},[s("q-btn",{staticClass:"col",attrs:{color:"teal",label:"扫描本地音声库",disable:"running"===t.state||!(t.loggedIn||t.$socket.connected)},on:{click:function(e){return t.performScan()}}})],1),s("div",{staticClass:"col-xs-6 col-sm-4 row q-pa-sm"},[s("q-btn",{staticClass:"col",attrs:{color:"primary",label:"刷新音声库信息",disable:"running"===t.state||!(t.loggedIn||t.$socket.connected)},on:{click:function(e){return t.performUpdate()}}})],1),s("div",{staticClass:"col-xs-12 col-sm-4 row q-pa-sm"},[s("q-btn",{staticClass:"col",attrs:{color:"negative",label:"终止扫描进程",disable:"running"!==t.state||!(t.loggedIn||t.$socket.connected)},on:{click:function(e){return t.killScanProceess()}}})],1)]),s("q-card",{directives:[{name:"show",rawName:"v-show",value:t.state,expression:"state"}],staticClass:"q-ma-md"},[s("q-expansion-item",{attrs:{"expand-separator":""},scopedSlots:t._u([{key:"header",fn:function(){return[s("q-item-section",{attrs:{avatar:""}},["running"===t.state?s("q-spinner-gears",{attrs:{color:"primary",size:"2em"}}):"finished"===t.state?s("q-icon",{attrs:{name:"done",color:"positive",size:"2em"}}):"error"===t.state?s("q-icon",{attrs:{name:"bug_report",color:"red",size:"2em"}}):t._e()],1),s("q-item-section",[t.allLogs.length>1?s("q-item-label",{staticClass:"ellipsis"},[t._v(t._s(t.allLogs[t.allLogs.length-2].message))]):t._e(),t.allLogs.length>0?s("q-item-label",{staticClass:"ellipsis"},[t._v(t._s(t.allLogs[t.allLogs.length-1].message))]):t._e()],1)]},proxy:!0}])},[s("q-scroll-area",{staticClass:"bg-dark text-white q-pa-md",staticStyle:{height:"256px"}},t._l(t.allLogs,(function(e,a){return s("div",{key:a},[s("span",{class:"error"===e.level?"text-red":""},[t._v("➜ "+t._s(e.message))])])})),0)],1)],1),s("q-card",{directives:[{name:"show",rawName:"v-show",value:t.tasks.length>0||t.failedTasks.length>0,expression:"(tasks.length > 0) || (failedTasks.length > 0)"}],staticClass:"q-ma-md"},[s("q-tabs",{staticClass:"text-grey",attrs:{dense:"","inline-label":"","active-color":"white","active-bg-color":"brown","indicator-color":"yellow",align:"justify","narrow-indicator":""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[s("q-tab",{attrs:{name:"tasks",icon:"hourglass_full",label:"处理中"}},[s("q-badge",{directives:[{name:"show",rawName:"v-show",value:t.tasks.length>0,expression:"tasks.length > 0"}],attrs:{color:"primary",floating:""}},[t._v(t._s(t.tasks.length))])],1),s("q-tab",{attrs:{name:"failedTasks",icon:"error_outline",label:"处理失败"}},[s("q-badge",{directives:[{name:"show",rawName:"v-show",value:t.failedTasks.length>0,expression:"failedTasks.length > 0"}],attrs:{color:"red",floating:""}},[t._v(t._s(t.failedTasks.length))])],1)],1),s("q-separator"),s("q-tab-panels",{attrs:{animated:""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[s("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:"tasks"}},[s("q-virtual-scroll",{staticStyle:{"max-height":"313px"},attrs:{separator:"",items:t.tasks,"virtual-scroll-item-size":52},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.item,r=e.index;return[s("q-expansion-item",{key:r,attrs:{"expand-separator":""},scopedSlots:t._u([{key:"header",fn:function(){return[s("q-item-section",{attrs:{avatar:""}},[s("q-spinner-hourglass",{attrs:{color:"primary",size:"2em"}})],1),s("q-item-section",[a.logs.length>0?s("q-item-label",{staticClass:"ellipsis"},[t._v(t._s(a.logs[a.logs.length-1].message))]):t._e(),s("q-item-label",{attrs:{caption:""}},[t._v(t._s("RJ"+a.rjcode))])],1)]},proxy:!0}],null,!0)},[s("q-card",[s("q-card-section",{staticClass:"bg-dark text-white"},t._l(a.logs,(function(e,a){return s("div",{key:a},[s("span",{class:"error"===e.level?"text-red":""},[t._v("➜ "+t._s(e.message))])])})),0)],1)],1)]}}])})],1),s("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:"failedTasks"}},[s("q-virtual-scroll",{staticStyle:{"max-height":"313px"},attrs:{separator:"",items:t.failedTasks,"virtual-scroll-item-size":52},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.item,r=e.index;return[s("q-expansion-item",{key:r,attrs:{"expand-separator":"","expand-icon-class":"text-white","header-class":"bg-negative"},scopedSlots:t._u([{key:"header",fn:function(){return[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:"bug_report",color:"white",size:"2em"}})],1),s("q-item-section",[s("q-item-label",{staticClass:"text-white ellipsis"},[t._v("\n                    "+t._s(a.logs[a.logs.length-1].message)+"\n                  ")]),s("q-item-label",{staticClass:"text-white",attrs:{caption:""}},[t._v("\n                    "+t._s("RJ"+a.rjcode)+"\n                  ")])],1)]},proxy:!0}],null,!0)},[s("q-card",[s("q-card-section",{staticClass:"bg-dark text-white"},t._l(a.logs,(function(e,a){return s("div",{key:a},[s("span",{class:"error"===e.level?"text-red":""},[t._v("➜ "+t._s(e.message))])])})),0)],1)],1)]}}])})],1)],1)],1)],1)},Us=[],Ds={name:"Scanner",mixins:[rt],data(){return{tab:"tasks",state:null,loggedIn:!1,tasks:[],failedTasks:[],mainLogs:[],results:[]}},sockets:{SCAN_TASKS(t){this.tasks=t.tasks},SCAN_FAILED_TASKS(t){this.failedTasks=t.failedTasks},SCAN_MAIN_LOGS(t){this.mainLogs=t.mainLogs},SCAN_RESULTS(t){this.results=t.results},SCAN_INIT_STATE(t){this.state="running",this.tasks=t.tasks,this.failedTasks=t.failedTasks,this.mainLogs=t.mainLogs,this.results=t.results},SCAN_FINISHED(t){this.state="finished",this.allLogs.push({level:"info",message:t.message})},SCAN_ERROR(){this.state="error"},success(){this.loggedIn=!0}},methods:{performScan(){this.tasks=[],this.failedTasks=[],this.mainLogs=[],this.results=[],this.state="running",this.$socket.emit("PERFORM_SCAN")},performUpdate(){this.tasks=[],this.failedTasks=[],this.mainLogs=[],this.results=[],this.state="running",this.$socket.emit("PERFORM_UPDATE")},killScanProceess(){this.$socket.emit("KILL_SCAN_PROCESS")}},computed:{allLogs(){const t=this.results.map(t=>"added"===t.result?{level:"info",message:`[RJ${t.rjcode}] 添加成功! Added: ${t.count}`}:"updated"===t.result?{level:"info",message:`[RJ${t.rjcode}] 更新成功! Updated: ${t.count}`}:{level:"error",message:`[RJ${t.rjcode}] 处理失败! Failed: ${t.count}`});return this.mainLogs.concat(t)}},mounted(){this.$socket.emit("ON_SCANNER_PAGE"),this.$socket.on("connect_error",()=>{this.showErrNotif("连接Socket失败")})}},Fs=Ds,js=s("3b73"),Bs=s("cf57"),Ws=s("429b"),zs=s("7460"),Ks=s("58a8"),Gs=s("adad"),Hs=s("823b"),Ys=s("a12b"),Vs=s("9149"),Js=Object(h["a"])(Fs,Os,Us,!1,null,null,null),Xs=Js.exports;G()(Js,"components",{QBtn:W["a"],QCard:ut["a"],QExpansionItem:js["a"],QItemSection:F["a"],QSpinnerGears:Bs["a"],QIcon:pt["a"],QItemLabel:B["a"],QScrollArea:Wt["a"],QTabs:Ws["a"],QTab:zs["a"],QBadge:Ks["a"],QSeparator:vt["a"],QTabPanels:Gs["a"],QTabPanel:Hs["a"],QVirtualScroll:Ys["a"],QSpinnerHourglass:Vs["a"],QCardSection:zt["a"]});var Zs=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-form",{on:{submit:t.onSubmit}},[s("q-card",{staticClass:"q-ma-md"},[s("q-toolbar",[s("q-toolbar-title",[t._v("播放器设置")])],1),s("q-list",[s("q-item",{staticStyle:{height:"70px"}},[s("q-item-section",[s("q-item-label",[t._v("后退按钮跳跃秒数")]),s("q-item-label",{attrs:{caption:""}},[t._v("播放时后退按钮跳跃秒数")])],1),s("q-item-section",{attrs:{avatar:""}},[s("div",{staticClass:"q-gutter-sm"},[s("q-radio",{attrs:{dense:"",val:"5",label:"5 秒"},model:{value:t.rewindSeekTime,callback:function(e){t.rewindSeekTime=e},expression:"rewindSeekTime"}}),s("q-radio",{attrs:{dense:"",val:"10",label:"10 秒"},model:{value:t.rewindSeekTime,callback:function(e){t.rewindSeekTime=e},expression:"rewindSeekTime"}}),s("q-radio",{attrs:{dense:"",val:"30",label:"30 秒"},model:{value:t.rewindSeekTime,callback:function(e){t.rewindSeekTime=e},expression:"rewindSeekTime"}})],1)])],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("前进按钮跳跃秒数")]),s("q-item-label",{attrs:{caption:""}},[t._v("播放时前进按钮跳跃秒数")])],1),s("q-item-section",{attrs:{avatar:""}},[s("div",{staticClass:"q-gutter-sm"},[s("q-radio",{attrs:{dense:"",val:"5",label:"5 秒"},model:{value:t.forwardSeekTime,callback:function(e){t.forwardSeekTime=e},expression:"forwardSeekTime"}}),s("q-radio",{attrs:{dense:"",val:"10",label:"10 秒"},model:{value:t.forwardSeekTime,callback:function(e){t.forwardSeekTime=e},expression:"forwardSeekTime"}}),s("q-radio",{attrs:{dense:"",val:"30",label:"30 秒"},model:{value:t.forwardSeekTime,callback:function(e){t.forwardSeekTime=e},expression:"forwardSeekTime"}})],1)])],1)],1)],1),s("q-card",{staticClass:"q-ma-md"},[s("q-toolbar",[s("q-toolbar-title",[t._v("爬虫相关设置")])],1),s("q-list",[s("q-item",{staticStyle:{height:"70px"}},[s("q-item-section",[s("q-item-label",[t._v("标签语言")]),s("q-item-label",{attrs:{caption:""}},[t._v("从 DLSite 爬取的标签元数据的语言")])],1),s("q-item-section",{attrs:{avatar:""}},[s("div",{staticClass:"q-gutter-sm"},[s("q-radio",{attrs:{dense:"",val:"zh-cn",label:"简"},model:{value:t.config.tagLanguage,callback:function(e){t.$set(t.config,"tagLanguage",e)},expression:"config.tagLanguage"}}),s("q-radio",{attrs:{dense:"",val:"zh-tw",label:"繁"},model:{value:t.config.tagLanguage,callback:function(e){t.$set(t.config,"tagLanguage",e)},expression:"config.tagLanguage"}}),s("q-radio",{attrs:{dense:"",val:"ja-jp",label:"日"},model:{value:t.config.tagLanguage,callback:function(e){t.$set(t.config,"tagLanguage",e)},expression:"config.tagLanguage"}})],1)])],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("DLsite 超时时间")]),s("q-item-label",{attrs:{caption:""}},[t._v("默认 10000 毫秒")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.dlsiteTimeout,callback:function(e){t.$set(t.config,"dlsiteTimeout",t._n(e))},expression:"config.dlsiteTimeout"}})],1)],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("HVDB 超时时间")]),s("q-item-label",{attrs:{caption:""}},[t._v("默认 10000 毫秒")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.hvdbTimeout,callback:function(e){t.$set(t.config,"hvdbTimeout",t._n(e))},expression:"config.hvdbTimeout"}})],1)],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("重新请求间隔时间")]),s("q-item-label",{attrs:{caption:""}},[t._v("默认 2000 毫秒")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.retryDelay,callback:function(e){t.$set(t.config,"retryDelay",t._n(e))},expression:"config.retryDelay"}})],1)],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("请求最大尝试次数")]),s("q-item-label",{attrs:{caption:""}},[t._v("默认 5")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.retry,callback:function(e){t.$set(t.config,"retry",t._n(e))},expression:"config.retry"}})],1)],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("爬虫并行任务数量")]),s("q-item-label",{attrs:{caption:""}},[t._v("默认 16")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.maxParallelism,callback:function(e){t.$set(t.config,"maxParallelism",t._n(e))},expression:"config.maxParallelism"}})],1)],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("HTTP 代理服务主机 IP")]),s("q-item-label",{attrs:{caption:""}},[t._v("此项为空时默认为本机")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-input",{staticStyle:{"max-width":"100px"},attrs:{"input-class":"text-right"},model:{value:t.config.httpProxyHost,callback:function(e){t.$set(t.config,"httpProxyHost",e)},expression:"config.httpProxyHost"}})],1)],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("HTTP 代理服务端口号 ")]),s("q-item-label",{attrs:{caption:""}},[t._v("此项为 0 时默认不使用代理")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.httpProxyPort,callback:function(e){t.$set(t.config,"httpProxyPort",t._n(e))},expression:"config.httpProxyPort"}})],1)],1)],1)],1),s("q-card",{staticClass:"q-ma-md"},[s("q-toolbar",[s("q-toolbar-title",[t._v("文件夹扫描相关设置")])],1),s("q-list",[s("q-item",{staticStyle:{height:"70px"}},[s("q-item-section",[s("q-item-label",[t._v("最大递归扫描深度")]),s("q-item-label",{attrs:{caption:""}},[t._v("默认 2")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.scannerMaxRecursionDepth,callback:function(e){t.$set(t.config,"scannerMaxRecursionDepth",t._n(e))},expression:"config.scannerMaxRecursionDepth"}})],1)],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("扫描时跳过清理音声库")]),s("q-item-label",{attrs:{caption:""}},[t._v("是否跳过清理不存在的音声（不推荐，默认不跳过）")])],1),s("q-item-section",{attrs:{side:""}},[s("q-toggle",{attrs:{dense:""},model:{value:t.config.skipCleanup,callback:function(e){t.$set(t.config,"skipCleanup",e)},expression:"config.skipCleanup"}})],1)],1)],1)],1),s("q-card",{staticClass:"q-ma-md"},[s("q-toolbar",[s("q-toolbar-title",[t._v("Web 服务器相关设置")]),s("div",{staticClass:"q-pr-xs"},[t._v("更改此设置需要重启程序")])],1),s("q-list",[s("q-item",{staticStyle:{height:"70px"}},[s("q-item-section",[s("q-item-label",[t._v("用户验证")]),s("q-item-label",{attrs:{caption:""}},[t._v("是否启用用户验证（生产环境下无法修改此设置）")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-toggle",{attrs:{dense:"",disable:t.config.production},model:{value:t.config.auth,callback:function(e){t.$set(t.config,"auth",e)},expression:"config.auth"}})],1)],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("启用Gzip")]),s("q-item-label",{attrs:{caption:""}},[t._v("对网络传输启用Gzip压缩")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-toggle",{attrs:{dense:""},model:{value:t.config.enableGzip,callback:function(e){t.$set(t.config,"enableGzip",e)},expression:"config.enableGzip"}})],1)],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("设置端口号")]),s("q-item-label",{attrs:{caption:""}},[t._v("服务器监听端口号")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.listenPort,callback:function(e){t.$set(t.config,"listenPort",t._n(e))},expression:"config.listenPort"}})],1)],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("屏蔽远程连接")]),s("q-item-label",{attrs:{caption:""}},[t._v("只允许本地访问，默认为false。更改此设置需要重启程序")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-toggle",{attrs:{dense:""},model:{value:t.config.blockRemoteConnection,callback:function(e){t.$set(t.config,"blockRemoteConnection",e)},expression:"config.blockRemoteConnection"}})],1)],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("token 过期时间")]),s("q-item-label",{attrs:{caption:""}},[t._v("默认 2592000 秒")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.expiresIn,callback:function(e){t.$set(t.config,"expiresIn",t._n(e))},expression:"config.expiresIn"}})],1)],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("每页显示的音声数量")]),s("q-item-label",{attrs:{caption:""}},[t._v("默认 12")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-input",{staticStyle:{"max-width":"100px"},attrs:{type:"number","input-class":"text-right"},model:{value:t.config.pageSize,callback:function(e){t.$set(t.config,"pageSize",t._n(e))},expression:"config.pageSize"}})],1)],1)],1)],1),s("q-card",{staticClass:"q-ma-md"},[s("q-toolbar",[s("q-toolbar-title",[t._v("安全设置")])],1),s("q-list",[s("q-item",{staticStyle:{height:"70px"}},[s("q-item-section",[s("q-item-label",[t._v("生产环境")]),s("q-item-label",{attrs:{caption:""}},[t._v("此设置无法在网页端修改，详情请查阅GitHub Wiki中关于配置文件的说明")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-toggle",{attrs:{dense:"",disable:""},model:{value:t.config.production,callback:function(e){t.$set(t.config,"production",e)},expression:"config.production"}})],1)],1)],1)],1),s("q-card",{staticClass:"q-ma-md"},[s("q-toolbar",[s("q-toolbar-title",[t._v("其它设置")])],1),s("q-list",[s("q-item",{staticStyle:{height:"70px"}},[s("q-item-section",[s("q-item-label",[t._v("检查更新")]),s("q-item-label",{attrs:{caption:""}},[t._v("打开网页时是否检查更新")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-toggle",{attrs:{dense:""},model:{value:t.config.checkUpdate,callback:function(e){t.$set(t.config,"checkUpdate",e)},expression:"config.checkUpdate"}})],1)],1),t.config.checkUpdate?s("q-item",[s("q-item-section",[s("q-item-label",[t._v("检查测试版更新")]),s("q-item-label",{attrs:{caption:""}},[t._v("是否检查测试版更新")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-toggle",{attrs:{dense:""},model:{value:t.config.checkBetaUpdate,callback:function(e){t.$set(t.config,"checkBetaUpdate",e)},expression:"config.checkBetaUpdate"}})],1)],1):t._e(),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("数据库使用默认路径")]),s("q-item-label",{attrs:{caption:""}},[t._v("使用程序所在位置下的sqlite文件夹，并忽略databaseFolderDir设置（如无必要请勿修改，更改此设置需要重启程序）")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-toggle",{attrs:{dense:""},model:{value:t.config.dbUseDefaultPath,callback:function(e){t.$set(t.config,"dbUseDefaultPath",e)},expression:"config.dbUseDefaultPath"}})],1)],1),s("q-item",[s("q-item-section",[s("q-item-label",[t._v("封面使用默认路径")]),s("q-item-label",{attrs:{caption:""}},[t._v("使用程序所在位置下的covers文件夹，并忽略封面文件夹路径设置")])],1),s("q-item-section",{attrs:{avatar:""}},[s("q-toggle",{attrs:{dense:""},model:{value:t.config.coverUseDefaultPath,callback:function(e){t.$set(t.config,"coverUseDefaultPath",e)},expression:"config.coverUseDefaultPath"}})],1)],1)],1)],1),s("div",{staticClass:"q-ma-lg row justify-end"},[s("q-btn",{attrs:{loading:t.loading,label:"保存",type:"submit",color:"primary"}})],1)],1)},ta=[],ea={name:"Advanced",mixins:[rt],data(){return{config:{},loading:!1,rewindSeekTime:"5",forwardSeekTime:"30"}},methods:{requestConfig(){this.$axios.get("/api/config/admin").then(t=>{this.config=t.data.config,this.rewindSeekTime=this.config.rewindSeekTime.toString(),this.forwardSeekTime=this.config.forwardSeekTime.toString()}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},onSubmit(){this.config.rewindSeekTime=parseInt(this.rewindSeekTime),this.config.forwardSeekTime=parseInt(this.forwardSeekTime),this.loading=!0,this.$axios.put("/api/config/admin",{config:this.config}).then(t=>{this.loading=!1,this.showSuccNotif(t.data.message)}).catch(t=>{this.loading=!1,t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}},created(){this.requestConfig()}},sa=ea,aa=s("3786"),ra=s("9564"),ia=Object(h["a"])(sa,Zs,ta,!1,null,null,null),oa=ia.exports;G()(ia,"components",{QForm:fs["a"],QCard:ut["a"],QToolbar:Dt["a"],QToolbarTitle:Ft["a"],QList:ft["a"],QItem:D["a"],QItemSection:F["a"],QItemLabel:B["a"],QRadio:aa["a"],QInput:jt["a"],QToggle:ra["a"],QBtn:W["a"]});var na=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("q-card",{staticClass:"q-ma-md"},[s("q-form",{on:{submit:function(e){return t.updateAdminPassword()}}},[s("q-toolbar",[s("q-toolbar-title",[t._v("修改管理员密码")])],1),s("div",{staticClass:"q-pa-sm"},[s("q-input",{attrs:{outlined:"",dense:"",type:"password",label:"新密码","lazy-rules":"",rules:[function(t){return t.length>=5||"密码长度至少为 5"}]},model:{value:t.adminNewPassword,callback:function(e){t.adminNewPassword=e},expression:"adminNewPassword"}}),s("q-input",{attrs:{outlined:"",dense:"",type:"password",label:"确认密码","lazy-rules":"",rules:[function(t){return t.length>=5||"密码长度至少为 5"},function(e){return e===t.adminNewPassword||"两次密码输入不一致"}]},model:{value:t.adminConfirmPassword,callback:function(e){t.adminConfirmPassword=e},expression:"adminConfirmPassword"}}),s("div",{staticClass:"row justify-end"},[s("q-btn",{attrs:{loading:t.loadingUpdateAdminPassword,type:"submit",color:"primary",label:"修改"}})],1)],1)],1)],1),s("q-card",{staticClass:"q-ma-md"},[s("q-form",{on:{submit:function(e){return t.addNewUser()}}},[s("q-toolbar",[s("q-toolbar-title",[t._v("添加新用户")])],1),s("div",{staticClass:"q-pa-sm"},[s("q-select",{staticClass:"q-mb-md",attrs:{dense:"",outlined:"",label:"用户组",options:t.groups},model:{value:t.newuser.group,callback:function(e){t.$set(t.newuser,"group",e)},expression:"newuser.group"}}),s("q-input",{attrs:{outlined:"",dense:"",label:"用户名",required:"","lazy-rules":"",rules:[function(t){return t.length>=5||"用户名长度至少为 5"},function(e){return!t.users.find((function(t){return t.name===e}))||"该名称已存在，用户名不能重复"}]},model:{value:t.newuser.name,callback:function(e){t.$set(t.newuser,"name",e)},expression:"newuser.name"}}),s("q-input",{attrs:{outlined:"",dense:"",label:"密码","lazy-rules":"",rules:[function(t){return t.length>=5||"密码长度至少为 5"}]},model:{value:t.newuser.password,callback:function(e){t.$set(t.newuser,"password",e)},expression:"newuser.password"}}),s("div",{staticClass:"row justify-end"},[s("q-btn",{attrs:{loading:t.loadingAddNewUser,type:"submit",color:"primary",label:"添加"}})],1)],1)],1)],1),s("q-card",{staticClass:"q-ma-md q-pa-sm"},[s("q-table",{attrs:{title:"所有用户",data:t.users,columns:t.columns,"row-key":"name","selected-rows-label":t.getSelectedString,selection:"multiple",selected:t.selected},on:{"update:selected":function(e){t.selected=e}}}),s("div",{staticClass:"row justify-end"},[s("q-btn",{attrs:{loading:t.loadingDeleteUsers,disable:0===t.selected.length,color:"primary",label:"删除"},on:{click:function(e){t.confirm=!0}}})],1)],1),s("q-dialog",{attrs:{persistent:""},model:{value:t.confirm,callback:function(e){t.confirm=e},expression:"confirm"}},[s("q-card",[s("q-card-section",{staticClass:"row items-center"},[s("span",{staticClass:"q-ma-sm text-h6"},[t._v("确认删除选中用户？")])]),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消",color:"primary"}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确认",color:"primary"},on:{click:function(e){return t.deleteUsers()}}})],1)],1)],1)],1)},la=[],ca={mixins:[rt],data(){return{selected:[],columns:[{name:"desc",required:!0,label:"用户名",align:"left",field:"name",sortable:!0},{name:"calories",required:!0,label:"用户组",align:"center",field:"group",sortable:!0}],users:[],loadingDeleteUsers:!1,newuser:{name:"",password:"",group:"user"},groups:["user","guest"],loadingAddNewUser:!1,adminNewPassword:"",adminConfirmPassword:"",loadingUpdateAdminPassword:!1,confirm:!1}},methods:{getSelectedString(){return 0===this.selected.length?"":`${this.selected.length} record${this.selected.length>1?"s":""} selected of ${this.users.length}`},addNewUser(){this.loadingAddNewUser=!0,this.$axios.post("/api/credentials/user",{name:this.newuser.name,password:this.newuser.password,group:this.newuser.group}).then(t=>{this.users.push(this.newuser),this.loadingAddNewUser=!1,this.showSuccNotif(t.data.message),this.requestUsers()}).catch(t=>{this.loadingAddNewUser=!1,422===t.response.status?this.showErrNotif(t.response.data.errors[0].msg):403===t.response.status?this.showWarnNotif(t.response.data.error):this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`)})},deleteUsers(){this.loadingDeleteUsers=!0,this.$axios.delete("/api/credentials/user",{data:{users:this.selected}}).then(t=>{this.selected.forEach(t=>{const e=this.users.findIndex(e=>e.name===t.name);this.users.splice(e,1)}),this.loadingDeleteUsers=!1,this.showSuccNotif(t.data.message),this.requestUsers()}).catch(t=>{this.loadingDeleteUsers=!1,t.response?403===t.response.status?this.showWarnNotif(t.response.data.error):this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},updateAdminPassword(){this.loadingUpdateAdminPassword=!0,this.$axios.put("/api/credentials/user",{name:"admin",newPassword:this.adminNewPassword}).then(t=>{this.loadingUpdateAdminPassword=!1;try{this.$q.localStorage.set("jwt-token","")}catch(e){this.showErrNotif(e.message)}this.showSuccNotif(t.data.message),this.$store.state.User.auth&&(console.log("Got here"),this.$router.push("/login"))}).catch(t=>{this.loadingUpdateAdminPassword=!1,t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},requestUsers(){this.$axios.get("/api/credentials/users").then(t=>{this.users=t.data.users}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}},created(){this.requestUsers()}},da=ca,ua=s("eaac"),ma=Object(h["a"])(da,na,la,!1,null,null,null),pa=ma.exports;function ha(t,e){return e.map(e=>(e.path=t+""+e.path,e))}G()(ma,"components",{QCard:ut["a"],QForm:fs["a"],QToolbar:Dt["a"],QToolbarTitle:Ft["a"],QInput:jt["a"],QBtn:W["a"],QSelect:Ce["a"],QTable:ua["a"],QDialog:ht["a"],QCardSection:zt["a"],QCardActions:Lt["a"]}),G()(ma,"directives",{ClosePopup:wt["a"]});const ga=[{path:"/",component:Xt,children:[{path:"admin/",component:Ms},{path:"admin/scanner",component:Xs},{path:"admin/advanced",component:oa},{path:"admin/usermanage",component:pa},{path:"",redirect:{name:"works"}},{path:"works",name:"works",component:Ie},{path:"work/:id",component:as},{path:"circles",props:{restrict:"circles"},component:cs},{path:"series",props:{restrict:"series"},component:cs},{path:"tags",props:{restrict:"tags"},component:cs},{path:"vas",props:{restrict:"vas"},component:cs},...ha("favourites",[{path:"",props:{route:"review"},component:Ps},{path:"/review",props:{route:"review"},component:Ps},...ha("/progress",[{path:"",props:{route:"progress",progress:"marked"},component:Ps},{path:"/marked",props:{route:"progress",progress:"marked"},component:Ps},{path:"/listening",props:{route:"progress",progress:"listening"},component:Ps},{path:"/listened",props:{route:"progress",progress:"listened"},component:Ps},{path:"/replay",props:{route:"progress",progress:"replay"},component:Ps},{path:"/postponed",props:{route:"progress",progress:"postponed"},component:Ps}]),{path:"/folder",props:{route:"folder"},component:Ps}])],meta:{auth:!0}},{path:"/login",component:qs}];ga.push({path:"*",component:()=>s.e(2).then(s.bind(null,"e51e"))});var va=ga;a["default"].use(N["a"]);var fa=function(){const t=new N["a"]({scrollBehavior(t,e,s){return s||{x:0,y:0}},routes:va,mode:"history",base:"/"});return t},wa=async function(){const t="function"===typeof P?await P({Vue:a["default"]}):P,e="function"===typeof fa?await fa({Vue:a["default"],store:t}):fa;t.$router=e;const s={router:e,store:t,render:t=>t(v),el:"#q-app"};return{app:s,store:t,router:e}},qa=s("9483");Object(qa["a"])("/service-worker.js",{ready(){},registered(){},cached(){},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh."),c["a"].create({message:"版本已更新",color:"primary",textColor:"white",icon:"cached",actions:[{label:"刷新",color:"white"}],timeout:1e4,onDismiss(){location.reload(!0)}})},offline(){},error(){}});var ba=s("4971"),ka=s.n(ba);s("24df");a["default"].component("VueSlider",ka.a);var _a=s("afa7");a["default"].use(_a["a"],{plyr:{controls:["progress"]}});var ya=s("5132"),xa=s.n(ya);async function Sa(){const{app:t,store:e,router:s}=await wa();let r=!0;const i=t=>{r=!1,window.location.href=t},o=window.location.href.replace(window.location.origin,""),n=[void 0,void 0,void 0,void 0];for(let c=0;!0===r&&c<n.length;c++)if("function"===typeof n[c])try{await n[c]({app:t,router:s,store:e,Vue:a["default"],ssrContext:null,redirect:i,urlPath:o})}catch(l){return l&&l.url?void(window.location.href=l.url):void console.error("[Quasar] boot error:",l)}!1!==r&&new a["default"](t)}a["default"].use(new xa.a({debug:!1,connection:"",options:{autoConnect:!1,query:{auth_token:""}}})),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&window.navigator.standalone&&s.e(0).then(s.t.bind(null,"a0db",7)),Sa()},"31cd":function(t,e,s){},"479d":function(t,e,s){},"5a82":function(t,e,s){"use strict";var a=s("479d"),r=s.n(a);r.a},"6a18":function(t,e){},"6ad7":function(t,e,s){"use strict";var a=s("7750"),r=s.n(a);r.a},7661:function(t,e,s){},7750:function(t,e,s){},"89d3":function(t,e,s){"use strict";var a=s("e87e"),r=s.n(a);r.a},"8e3b":function(t,e,s){},9091:function(t,e,s){},b3a5:function(t,e,s){"use strict";var a=s("7661"),r=s.n(a);r.a},b5fb:function(t,e){},d2a8:function(t,e,s){"use strict";var a=s("9091"),r=s.n(a);r.a},e87e:function(t,e,s){}});
//# sourceMappingURL=app.cc82421a.js.map